
<!-- saved from url=(0159)file:///C:/Users/migue/code/capella-bot-demo/Luxury%205%20Star%20Hotels%20in%20Bangkok%20Thailand%20_%20Capella%20Bangkok%20-%20Homepage_files/kernel-host.html -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><script type="text/javascript">//<![CDATA[
(()=>{var Ui=Object.create;var Ie=Object.defineProperty,Vi=Object.defineProperties,kr=Object.getOwnPropertyDescriptor,zi=Object.getOwnPropertyDescriptors,Bi=Object.getOwnPropertyNames,ze=Object.getOwnPropertySymbols,$i=Object.getPrototypeOf,It=Object.prototype.hasOwnProperty,Rr=Object.prototype.propertyIsEnumerable;var Mr=(r,e,t)=>e in r?Ie(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,C=(r,e)=>{for(var t in e||(e={}))It.call(e,t)&&Mr(r,t,e[t]);if(ze)for(var t of ze(e))Rr.call(e,t)&&Mr(r,t,e[t]);return r},ke=(r,e)=>Vi(r,zi(e)),Ji=r=>Ie(r,"__esModule",{value:!0});var jr=(r,e)=>{var t={};for(var n in r)It.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&ze)for(var n of ze(r))e.indexOf(n)<0&&Rr.call(r,n)&&(t[n]=r[n]);return t};var y=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports);var Zi=(r,e,t)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of Bi(e))!It.call(r,n)&&n!=="default"&&Ie(r,n,{get:()=>e[n],enumerable:!(t=kr(e,n))||t.enumerable});return r},q=r=>Zi(Ji(Ie(r!=null?Ui($i(r)):{},"default",r&&r.__esModule&&"default"in r?{get:()=>r.default,enumerable:!0}:{value:r,enumerable:!0})),r),Re=(r,e,t,n)=>{for(var i=n>1?void 0:n?kr(e,t):e,o=r.length-1,s;o>=0;o--)(s=r[o])&&(i=(n?s(e,t,i):s(i))||i);return n&&i&&Ie(e,t,i),i};var f=(r,e,t)=>new Promise((n,i)=>{var o=c=>{try{a(t.next(c))}catch(u){i(u)}},s=c=>{try{a(t.throw(c))}catch(u){i(u)}},a=c=>c.done?n(c.value):Promise.resolve(c.value).then(o,s);a((t=t.apply(r,e)).next())});var v=y((ra,Je)=>{var Er,Dr,qr,Lr,Hr,Nr,Kr,Fr,Gr,Be,kt,Wr,Ur,Vr,ee,zr,Br,$r,Jr,Zr,Yr,Qr,Xr,en,$e;(function(r){var e=typeof global=="object"?global:typeof self=="object"?self:typeof this=="object"?this:{};typeof define=="function"&&undefined?define("tslib",["exports"],function(n){r(t(e,t(n)))}):typeof Je=="object"&&typeof Je.exports=="object"?r(t(e,t(Je.exports))):r(t(e));function t(n,i){return n!==e&&(typeof Object.create=="function"?Object.defineProperty(n,"__esModule",{value:!0}):n.__esModule=!0),function(o,s){return n[o]=i?i(o,s):s}}})(function(r){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])};Er=function(n,i){if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");e(n,i);function o(){this.constructor=n}n.prototype=i===null?Object.create(i):(o.prototype=i.prototype,new o)},Dr=Object.assign||function(n){for(var i,o=1,s=arguments.length;o<s;o++){i=arguments[o];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(n[a]=i[a])}return n},qr=function(n,i){var o={};for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&i.indexOf(s)<0&&(o[s]=n[s]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,s=Object.getOwnPropertySymbols(n);a<s.length;a++)i.indexOf(s[a])<0&&Object.prototype.propertyIsEnumerable.call(n,s[a])&&(o[s[a]]=n[s[a]]);return o},Lr=function(n,i,o,s){var a=arguments.length,c=a<3?i:s===null?s=Object.getOwnPropertyDescriptor(i,o):s,u;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(n,i,o,s);else for(var m=n.length-1;m>=0;m--)(u=n[m])&&(c=(a<3?u(c):a>3?u(i,o,c):u(i,o))||c);return a>3&&c&&Object.defineProperty(i,o,c),c},Hr=function(n,i){return function(o,s){i(o,s,n)}},Nr=function(n,i){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,i)},Kr=function(n,i,o,s){function a(c){return c instanceof o?c:new o(function(u){u(c)})}return new(o||(o=Promise))(function(c,u){function m(O){try{g(s.next(O))}catch(Q){u(Q)}}function A(O){try{g(s.throw(O))}catch(Q){u(Q)}}function g(O){O.done?c(O.value):a(O.value).then(m,A)}g((s=s.apply(n,i||[])).next())})},Fr=function(n,i){var o={label:0,sent:function(){if(c[0]&1)throw c[1];return c[1]},trys:[],ops:[]},s,a,c,u;return u={next:m(0),throw:m(1),return:m(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function m(g){return function(O){return A([g,O])}}function A(g){if(s)throw new TypeError("Generator is already executing.");for(;o;)try{if(s=1,a&&(c=g[0]&2?a.return:g[0]?a.throw||((c=a.return)&&c.call(a),0):a.next)&&!(c=c.call(a,g[1])).done)return c;switch(a=0,c&&(g=[g[0]&2,c.value]),g[0]){case 0:case 1:c=g;break;case 4:return o.label++,{value:g[1],done:!1};case 5:o.label++,a=g[1],g=[0];continue;case 7:g=o.ops.pop(),o.trys.pop();continue;default:if(c=o.trys,!(c=c.length>0&&c[c.length-1])&&(g[0]===6||g[0]===2)){o=0;continue}if(g[0]===3&&(!c||g[1]>c[0]&&g[1]<c[3])){o.label=g[1];break}if(g[0]===6&&o.label<c[1]){o.label=c[1],c=g;break}if(c&&o.label<c[2]){o.label=c[2],o.ops.push(g);break}c[2]&&o.ops.pop(),o.trys.pop();continue}g=i.call(n,o)}catch(O){g=[6,O],a=0}finally{s=c=0}if(g[0]&5)throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}},Gr=function(n,i){for(var o in n)o!=="default"&&!Object.prototype.hasOwnProperty.call(i,o)&&$e(i,n,o)},$e=Object.create?function(n,i,o,s){s===void 0&&(s=o);var a=Object.getOwnPropertyDescriptor(i,o);(!a||("get"in a?!i.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return i[o]}}),Object.defineProperty(n,s,a)}:function(n,i,o,s){s===void 0&&(s=o),n[s]=i[o]},Be=function(n){var i=typeof Symbol=="function"&&Symbol.iterator,o=i&&n[i],s=0;if(o)return o.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&s>=n.length&&(n=void 0),{value:n&&n[s++],done:!n}}};throw new TypeError(i?"Object is not iterable.":"Symbol.iterator is not defined.")},kt=function(n,i){var o=typeof Symbol=="function"&&n[Symbol.iterator];if(!o)return n;var s=o.call(n),a,c=[],u;try{for(;(i===void 0||i-- >0)&&!(a=s.next()).done;)c.push(a.value)}catch(m){u={error:m}}finally{try{a&&!a.done&&(o=s.return)&&o.call(s)}finally{if(u)throw u.error}}return c},Wr=function(){for(var n=[],i=0;i<arguments.length;i++)n=n.concat(kt(arguments[i]));return n},Ur=function(){for(var n=0,i=0,o=arguments.length;i<o;i++)n+=arguments[i].length;for(var s=Array(n),a=0,i=0;i<o;i++)for(var c=arguments[i],u=0,m=c.length;u<m;u++,a++)s[a]=c[u];return s},Vr=function(n,i,o){if(o||arguments.length===2)for(var s=0,a=i.length,c;s<a;s++)(c||!(s in i))&&(c||(c=Array.prototype.slice.call(i,0,s)),c[s]=i[s]);return n.concat(c||Array.prototype.slice.call(i))},ee=function(n){return this instanceof ee?(this.v=n,this):new ee(n)},zr=function(n,i,o){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var s=o.apply(n,i||[]),a,c=[];return a={},u("next"),u("throw"),u("return"),a[Symbol.asyncIterator]=function(){return this},a;function u(_){s[_]&&(a[_]=function(X){return new Promise(function(Ct,Wi){c.push([_,X,Ct,Wi])>1||m(_,X)})})}function m(_,X){try{A(s[_](X))}catch(Ct){Q(c[0][3],Ct)}}function A(_){_.value instanceof ee?Promise.resolve(_.value.v).then(g,O):Q(c[0][2],_)}function g(_){m("next",_)}function O(_){m("throw",_)}function Q(_,X){_(X),c.shift(),c.length&&m(c[0][0],c[0][1])}},Br=function(n){var i,o;return i={},s("next"),s("throw",function(a){throw a}),s("return"),i[Symbol.iterator]=function(){return this},i;function s(a,c){i[a]=n[a]?function(u){return(o=!o)?{value:ee(n[a](u)),done:a==="return"}:c?c(u):u}:c}},$r=function(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=n[Symbol.asyncIterator],o;return i?i.call(n):(n=typeof Be=="function"?Be(n):n[Symbol.iterator](),o={},s("next"),s("throw"),s("return"),o[Symbol.asyncIterator]=function(){return this},o);function s(c){o[c]=n[c]&&function(u){return new Promise(function(m,A){u=n[c](u),a(m,A,u.done,u.value)})}}function a(c,u,m,A){Promise.resolve(A).then(function(g){c({value:g,done:m})},u)}},Jr=function(n,i){return Object.defineProperty?Object.defineProperty(n,"raw",{value:i}):n.raw=i,n};var t=Object.create?function(n,i){Object.defineProperty(n,"default",{enumerable:!0,value:i})}:function(n,i){n.default=i};Zr=function(n){if(n&&n.__esModule)return n;var i={};if(n!=null)for(var o in n)o!=="default"&&Object.prototype.hasOwnProperty.call(n,o)&&$e(i,n,o);return t(i,n),i},Yr=function(n){return n&&n.__esModule?n:{default:n}},Qr=function(n,i,o,s){if(o==="a"&&!s)throw new TypeError("Private accessor was defined without a getter");if(typeof i=="function"?n!==i||!s:!i.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return o==="m"?s:o==="a"?s.call(n):s?s.value:i.get(n)},Xr=function(n,i,o,s,a){if(s==="m")throw new TypeError("Private method is not writable");if(s==="a"&&!a)throw new TypeError("Private accessor was defined without a setter");if(typeof i=="function"?n!==i||!a:!i.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return s==="a"?a.call(n,o):a?a.value=o:i.set(n,o),o},en=function(n,i){if(i===null||typeof i!="object"&&typeof i!="function")throw new TypeError("Cannot use 'in' operator on non-object");return typeof n=="function"?i===n:n.has(i)},r("__extends",Er),r("__assign",Dr),r("__rest",qr),r("__decorate",Lr),r("__param",Hr),r("__metadata",Nr),r("__awaiter",Kr),r("__generator",Fr),r("__exportStar",Gr),r("__createBinding",$e),r("__values",Be),r("__read",kt),r("__spread",Wr),r("__spreadArrays",Ur),r("__spreadArray",Vr),r("__await",ee),r("__asyncGenerator",zr),r("__asyncDelegator",Br),r("__asyncValues",$r),r("__makeTemplateObject",Jr),r("__importStar",Zr),r("__importDefault",Yr),r("__classPrivateFieldGet",Qr),r("__classPrivateFieldSet",Xr),r("__classPrivateFieldIn",en)})});var Me=y(te=>{"use strict";Object.defineProperty(te,"__esModule",{value:!0});te.compose=te.CompositeTransducer=void 0;var Rt=class{constructor(e,t){this.a=e,this.b=t}async_(e){return this.b.async_(this.a.async_(e))}sync(e){return this.b.sync(this.a.sync(e))}};te.CompositeTransducer=Rt;function Yi(r,e){return new Rt(r,e)}te.compose=Yi});var tn=y(Ze=>{"use strict";Object.defineProperty(Ze,"__esModule",{value:!0});Ze.decompose=void 0;var Qi=Me();function*Mt(r){r instanceof Qi.CompositeTransducer?(yield*Mt(r.a),yield*Mt(r.b)):yield r}Ze.decompose=Mt});var M=y(d=>{"use strict";Object.defineProperty(d,"__esModule",{value:!0});d.syncReturned=d.asyncReturned=d.isReturned=d.isYielded=d.AsyncIteratorHandler=d.by=d.toAsyncIterable=d.isArrayLike=d.asyncIterable=d.iterable=d.toIterable=d.isPromiseLike=d.isAsyncIterable=d.isIterable=d.value=d.key=d.comparators=d.descending=d.ascending=void 0;var K=v();function Ye(r,e){return r<e?-1:r>e?1:0}d.ascending=Ye;function Xi(r,e){return r<e?1:r>e?-1:0}d.descending=Xi;function eo(...r){return(e,t)=>{for(let n of r){let i=n(e,t);if(i!=0)return i}return 0}}d.comparators=eo;function to(r){return Object.assign(e=>e[r],{name:r})}d.key=to;function ro(r){return e=>e[r]}d.value=ro;function no(r){return typeof r=="object"&&Symbol.iterator in r}d.isIterable=no;function io(r){return typeof r=="object"&&Symbol.asyncIterator in r}d.isAsyncIterable=io;function oo(r){return typeof r=="object"&&"then"in r}d.isPromiseLike=oo;function so(...r){return r}d.toIterable=so;function*ao(r){for(let e=0;e<r.length;e++)yield r[e]}d.iterable=ao;function co(r){return K.__asyncGenerator(this,arguments,function*(){for(let t of r)yield yield K.__await(t)})}d.asyncIterable=co;function uo(r){return typeof r=="object"&&typeof r.length=="number"}d.isArrayLike=uo;function lo(r){return K.__asyncGenerator(this,arguments,function*(){yield yield K.__await(r)})}d.toAsyncIterable=lo;function po(r,e=Ye){return typeof r=="function"?go(r,e):fo(r,e)}d.by=po;function fo(r,e=Ye){return(t,n)=>e(t[r],n[r])}function go(r,e=Ye){return(t,n)=>e(r(t),r(n))}var rn=class{constructor(){this.handlers=[],this.state=[]}value(e){this.newState({value:e,done:!1})}error(e){this.newState(e)}close(e){this.newState({value:e,done:!0})}[Symbol.asyncIterator](){return this}next(){return new Promise((e,t)=>{this.newHandler([e,t])})}newState(e){let t=this.handlers.shift();if(typeof t=="undefined")return this.state.push(e);let n=this.state.shift();if(typeof n=="undefined")return this.consume(e,t);this.consume(n,t),this.newState(e)}newHandler(e){let t=this.state.shift();if(typeof t=="undefined")return this.handlers.push(e);let n=this.handlers.shift();if(typeof n=="undefined")return this.consume(t,e);this.consume(t,n),this.newHandler(e)}consume(e,[t,n]){e instanceof Error?n(e):t(e)}};d.AsyncIteratorHandler=rn;function yo(r){return r&&typeof r=="object"&&"yielded"in r}d.isYielded=yo;function mo(r){return r&&typeof r=="object"&&"returned"in r}d.isReturned=mo;function ho(r){return K.__asyncGenerator(this,arguments,function*(){for(;;){let{value:t,done:n}=yield K.__await(r.next());if(n){yield yield K.__await({returned:t});break}else yield yield K.__await({yielded:t})}})}d.asyncReturned=ho;function*bo(r){for(;;){let{value:e,done:t}=r.next();if(t){yield{returned:e};break}else yield{yielded:e}}}d.syncReturned=bo});var nn=y(ne=>{"use strict";Object.defineProperty(ne,"__esModule",{value:!0});ne.dedupe=ne.DedupeTransducer=void 0;var re=v(),xo=M(),jt=class{constructor(e){this.comparator=e}async_(e){return re.__asyncGenerator(this,arguments,function*(){var n,i;let o;try{for(var s=re.__asyncValues(e),a;a=yield re.__await(s.next()),!a.done;){let c=a.value;typeof o=="undefined"?yield yield re.__await(c):this.comparator(c,o)!==0&&(yield yield re.__await(c)),o=c}}catch(c){n={error:c}}finally{try{a&&!a.done&&(i=s.return)&&(yield re.__await(i.call(s)))}finally{if(n)throw n.error}}})}*sync(e){let t;for(let n of e)typeof t=="undefined"?yield n:this.comparator(n,t)!==0&&(yield n),t=n}};ne.DedupeTransducer=jt;function vo(r=xo.ascending){return new jt(r)}ne.dedupe=vo});var on=y(ie=>{"use strict";Object.defineProperty(ie,"__esModule",{value:!0});ie.drop=ie.DropTransducer=void 0;var je=v(),Et=class{constructor(e){if(this.count=e,typeof e=="undefined")throw new Error("Count can not be undefined")}async_(e){return je.__asyncGenerator(this,arguments,function*(){var n,i;try{for(var o=je.__asyncValues(e),s;s=yield je.__await(o.next()),!s.done;){let a=s.value;--this.count<0&&(yield yield je.__await(a))}}catch(a){n={error:a}}finally{try{s&&!s.done&&(i=o.return)&&(yield je.__await(i.call(o)))}finally{if(n)throw n.error}}})}*sync(e){for(let t of e)--this.count<0&&(yield t)}};ie.DropTransducer=Et;function wo(r){return new Et(r)}ie.drop=wo});var sn=y(oe=>{"use strict";Object.defineProperty(oe,"__esModule",{value:!0});oe.dropWhile=oe.DropWhileTransducer=void 0;var Ee=v(),Dt=class{constructor(e){this.predicate=e}async_(e){return Ee.__asyncGenerator(this,arguments,function*(){var n,i;let o=!0;try{for(var s=Ee.__asyncValues(e),a;a=yield Ee.__await(s.next()),!a.done;){let c=a.value;o&&(o=this.predicate(c)),o||(yield yield Ee.__await(c))}}catch(c){n={error:c}}finally{try{a&&!a.done&&(i=s.return)&&(yield Ee.__await(i.call(s)))}finally{if(n)throw n.error}}})}*sync(e){let t=!0;for(let n of e)t&&(t=this.predicate(n)),t||(yield n)}};oe.DropWhileTransducer=Dt;function _o(r){return new Dt(r)}oe.dropWhile=_o});var Qe=y(F=>{"use strict";Object.defineProperty(F,"__esModule",{value:!0});F.accept=F.filter=F.FilterTransducer=void 0;var De=v(),qt=class{constructor(e){this.predicate=e}async_(e){return De.__asyncGenerator(this,arguments,function*(){var n,i;try{for(var o=De.__asyncValues(e),s;s=yield De.__await(o.next()),!s.done;){let a=s.value;this.predicate(a)&&(yield yield De.__await(a))}}catch(a){n={error:a}}finally{try{s&&!s.done&&(i=o.return)&&(yield De.__await(i.call(o)))}finally{if(n)throw n.error}}})}*sync(e){for(let t of e)this.predicate(t)&&(yield t)}};F.FilterTransducer=qt;function an(r){return new qt(r)}F.filter=an;F.accept=an});var Ht=y(ae=>{"use strict";Object.defineProperty(ae,"__esModule",{value:!0});ae.first=ae.FirstTransducer=void 0;var se=v(),Lt=class{async_(e){return se.__asyncGenerator(this,arguments,function*(){var n,i;try{for(var o=se.__asyncValues(e),s;s=yield se.__await(o.next()),!s.done;){let a=s.value;return yield se.__await(yield yield se.__await(a))}}catch(a){n={error:a}}finally{try{s&&!s.done&&(i=o.return)&&(yield se.__await(i.call(o)))}finally{if(n)throw n.error}}})}*sync(e){for(let t of e)return yield t}};ae.FirstTransducer=Lt;function To(){return new Lt}ae.first=To});var cn=y(Xe=>{"use strict";Object.defineProperty(Xe,"__esModule",{value:!0});Xe.find=void 0;var Po=Qe(),So=Ht(),Ao=Me();function Oo(r){return(0,Ao.compose)((0,Po.filter)(r),(0,So.first)())}Xe.find=Oo});var un=y(ce=>{"use strict";Object.defineProperty(ce,"__esModule",{value:!0});ce.flatMap=ce.FlatMapTransducer=void 0;var z=v(),Nt=class{constructor(e){this.mapper=e}async_(e){return z.__asyncGenerator(this,arguments,function*(){var n,i;try{for(var o=z.__asyncValues(e),s;s=yield z.__await(o.next()),!s.done;){let a=s.value;yield z.__await(yield*z.__asyncDelegator(z.__asyncValues(this.mapper(a))))}}catch(a){n={error:a}}finally{try{s&&!s.done&&(i=o.return)&&(yield z.__await(i.call(o)))}finally{if(n)throw n.error}}})}*sync(e){for(let t of e)yield*this.mapper(t)}};ce.FlatMapTransducer=Nt;function Co(r){return new Nt(r)}ce.flatMap=Co});var ln=y(G=>{"use strict";Object.defineProperty(G,"__esModule",{value:!0});G.transducer=G.identity=G.IdentityTransducer=void 0;var Kt=class{async_(e){return e}sync(e){return e}};G.IdentityTransducer=Kt;function dn(){return new Kt}G.identity=dn;G.transducer=dn});var Gt=y(ue=>{"use strict";Object.defineProperty(ue,"__esModule",{value:!0});ue.last=ue.LastTransducer=void 0;var qe=v(),Ft=class{async_(e){return qe.__asyncGenerator(this,arguments,function*(){var n,i;let o;try{for(var s=qe.__asyncValues(e),a;a=yield qe.__await(s.next()),!a.done;)o=a.value}catch(c){n={error:c}}finally{try{a&&!a.done&&(i=s.return)&&(yield qe.__await(i.call(s)))}finally{if(n)throw n.error}}o!==void 0&&(yield yield qe.__await(o))})}*sync(e){let t;for(t of e);t!==void 0&&(yield t)}};ue.LastTransducer=Ft;function Io(){return new Ft}ue.last=Io});var pn=y(de=>{"use strict";Object.defineProperty(de,"__esModule",{value:!0});de.map=de.MapTransducer=void 0;var Le=v(),Wt=class{constructor(e){this.mapper=e}async_(e){return Le.__asyncGenerator(this,arguments,function*(){var n,i;try{for(var o=Le.__asyncValues(e),s;s=yield Le.__await(o.next()),!s.done;){let a=s.value;yield yield Le.__await(this.mapper(a))}}catch(a){n={error:a}}finally{try{s&&!s.done&&(i=o.return)&&(yield Le.__await(i.call(o)))}finally{if(n)throw n.error}}})}*sync(e){for(let t of e)yield this.mapper(t)}};de.MapTransducer=Wt;function ko(r){return new Wt(r)}de.map=ko});var Vt=y(pe=>{"use strict";Object.defineProperty(pe,"__esModule",{value:!0});pe.scan=pe.ScanTransducer=void 0;var le=v(),Ut=class{constructor(e,t){this.reducer=e,this.seed=t}async_(e){return le.__asyncGenerator(this,arguments,function*(){var n,i;let o=this.seed;yield yield le.__await(o);try{for(var s=le.__asyncValues(e),a;a=yield le.__await(s.next()),!a.done;){let c=a.value;yield yield le.__await(o=this.reducer(o,c))}}catch(c){n={error:c}}finally{try{a&&!a.done&&(i=s.return)&&(yield le.__await(i.call(s)))}finally{if(n)throw n.error}}})}*sync(e){let t=this.seed;yield t;for(let n of e)yield t=this.reducer(t,n)}};pe.ScanTransducer=Ut;function Ro(r,e){return new Ut(r,e)}pe.scan=Ro});var fn=y(et=>{"use strict";Object.defineProperty(et,"__esModule",{value:!0});et.reduce=void 0;var Mo=Me(),jo=Gt(),Eo=Vt();function Do(r,e){return(0,Mo.compose)((0,Eo.scan)(r,e),(0,jo.last)())}et.reduce=Do});var gn=y(tt=>{"use strict";Object.defineProperty(tt,"__esModule",{value:!0});tt.reject=void 0;var qo=Qe();function Lo(r){return new qo.FilterTransducer(e=>!r(e))}tt.reject=Lo});var yn=y(L=>{"use strict";Object.defineProperty(L,"__esModule",{value:!0});L.sum=L.subtract=L.add=L.increment=void 0;function Ho(r){return r+1}L.increment=Ho;function No(r,e){return e===void 0?t=>r+t:r+e}L.add=No;function Ko(r,e){return e===void 0?t=>t-r:r-e}L.subtract=Ko;var Fo=(r,e)=>r+e;L.sum=Fo});var it=y(S=>{"use strict";Object.defineProperty(S,"__esModule",{value:!0});S.AsyncSequence=S.Sequence=S.sequence=S.range=S.repeat=S.iterate=void 0;var zt=yn(),Bt=M(),mn=He();function*rt(r,e){for(;;)yield e,e=r(e)}S.iterate=rt;function*Go(r){for(;;)yield r()}S.repeat=Go;function*Wo(r,e,t=1){if(t===0)throw new Error("step can not be 0");if(e===void 0)yield*rt((0,zt.add)(t),r);else{let n=Math.abs(t);e<r?yield*$t(rt((0,zt.subtract)(n),r),(0,mn.takeWhile)(i=>i>=e)):yield*$t(rt((0,zt.add)(n),r),(0,mn.takeWhile)(i=>i<=e))}}S.range=Wo;function $t(r,...e){return(0,Bt.isIterable)(r)?new nt(r,e):(0,Bt.isArrayLike)(r)?new nt((0,Bt.iterable)(r),e):new Jt(r,e)}S.sequence=$t;var nt=class{constructor(e,t){this.source=e,this.transducers=t}[Symbol.iterator](){return this.transducers.reduce((e,t)=>t.sync(e),this.source)[Symbol.iterator]()}};S.Sequence=nt;var Jt=class{constructor(e,t){this.source=e,this.transducers=t}[Symbol.asyncIterator](){return this.transducers.reduce((e,t)=>t.async_(e),this.source)[Symbol.asyncIterator]()}};S.AsyncSequence=Jt});var xn=y(ot=>{"use strict";Object.defineProperty(ot,"__esModule",{value:!0});ot.single=void 0;var hn=v(),Uo=M(),bn=it();function Vo(r,...e){return(0,Uo.isIterable)(r)?zo((0,bn.sequence)(r,...e)):Bo((0,bn.sequence)(r,...e))}ot.single=Vo;function zo(r){for(let e of r)return e;throw new Error("Expected a single value")}function Bo(r){var e,t,n,i;return hn.__awaiter(this,void 0,void 0,function*(){try{for(e=hn.__asyncValues(r);t=yield e.next(),!t.done;)return t.value}catch(o){n={error:o}}finally{try{t&&!t.done&&(i=e.return)&&(yield i.call(e))}finally{if(n)throw n.error}}throw new Error("Expected a single value")})}});var Zt=y(st=>{"use strict";Object.defineProperty(st,"__esModule",{value:!0});st.array=void 0;var vn=v(),wn=M(),_n=it();function $o(r,...e){return(0,wn.isIterable)(r)||(0,wn.isArrayLike)(r)?Jo((0,_n.sequence)(r,...e)):Zo((0,_n.sequence)(r,...e))}st.array=$o;function Jo(r){let e=[];for(let t of r)e.push(t);return e}function Zo(r){var e,t,n,i;return vn.__awaiter(this,void 0,void 0,function*(){let o=[];try{for(e=vn.__asyncValues(r);t=yield e.next(),!t.done;){let s=t.value;o.push(s)}}catch(s){n={error:s}}finally{try{t&&!t.done&&(i=e.return)&&(yield i.call(e))}finally{if(n)throw n.error}}return o})}});var Pn=y(fe=>{"use strict";Object.defineProperty(fe,"__esModule",{value:!0});fe.sort=fe.SortTransducer=void 0;var Ne=v(),Yo=M(),Tn=Zt(),Yt=class{constructor(e){this.comparator=e}async_(e){return Ne.__asyncGenerator(this,arguments,function*(){let n=yield Ne.__await((0,Tn.array)(e));n.sort(this.comparator),yield Ne.__await(yield*Ne.__asyncDelegator(Ne.__asyncValues(n)))})}*sync(e){let t=(0,Tn.array)(e);t.sort(this.comparator),yield*t}};fe.SortTransducer=Yt;function Qo(r=Yo.ascending){return new Yt(r)}fe.sort=Qo});var Sn=y(ge=>{"use strict";Object.defineProperty(ge,"__esModule",{value:!0});ge.take=ge.TakeTransducer=void 0;var B=v(),Qt=class{constructor(e){if(this.count=e,typeof e=="undefined")throw new Error("Count can not be undefined")}async_(e){return B.__asyncGenerator(this,arguments,function*(){var n,i;if(this.count<1)return yield B.__await(void 0);try{for(var o=B.__asyncValues(e),s;s=yield B.__await(o.next()),!s.done;){let a=s.value;if(yield yield B.__await(a),--this.count<1)return yield B.__await(void 0)}}catch(a){n={error:a}}finally{try{s&&!s.done&&(i=o.return)&&(yield B.__await(i.call(o)))}finally{if(n)throw n.error}}})}*sync(e){if(!(this.count<1)){for(let t of e)if(yield t,--this.count<1)return}}};ge.TakeTransducer=Qt;function Xo(r){return new Qt(r)}ge.take=Xo});var An=y(me=>{"use strict";Object.defineProperty(me,"__esModule",{value:!0});me.takeWhile=me.TakeWhileTransducer=void 0;var ye=v(),Xt=class{constructor(e){this.predicate=e}async_(e){return ye.__asyncGenerator(this,arguments,function*(){var n,i;try{for(var o=ye.__asyncValues(e),s;s=yield ye.__await(o.next()),!s.done;){let a=s.value;if(this.predicate(a))yield yield ye.__await(a);else return yield ye.__await(void 0)}}catch(a){n={error:a}}finally{try{s&&!s.done&&(i=o.return)&&(yield ye.__await(i.call(o)))}finally{if(n)throw n.error}}})}*sync(e){for(let t of e)if(this.predicate(t))yield t;else return}};me.TakeWhileTransducer=Xt;function es(r){return new Xt(r)}me.takeWhile=es});var Cn=y(On=>{"use strict";Object.defineProperty(On,"__esModule",{value:!0})});var er=y(W=>{"use strict";Object.defineProperty(W,"__esModule",{value:!0});W.container=W.lazy=W.replace=void 0;function In(r,e,t){return Object.defineProperty(r,e,{value:t})}W.replace=In;function kn(r,e,t){if(typeof t.get=="undefined")throw new Error("@lazy can only decorate getter methods");return Object.defineProperty(r,e,Object.assign(Object.assign({},t),{get(){return In(this,e,t.get.call(this))[e]}}))}W.lazy=kn;function ts(r){return Object.keys(r).reduce((e,t)=>kn(e,t,{configurable:!0,get:()=>r[t](e)}),{})}W.container=ts});var Hn=y(ct=>{"use strict";Object.defineProperty(ct,"__esModule",{value:!0});ct.AVLTree=void 0;var Rn=v(),at=M(),Mn=er(),H=class{constructor(e){this.comparator=e}static empty(e=at.ascending){return new jn(e)}static create(e,t,n=at.ascending){let i=H.empty(n);return new I(n,e,t,i,i)}static of(e,t=at.ascending){return H.preSorted(e.sort((0,at.by)(0)),t,H.empty(t))}static preSorted(e,t,n){let i=e.length;switch(i){case 0:return n;case 1:{let[[o,s]]=e;return new I(t,o,s,n,n)}default:{let o=Math.floor(i/2),s=H.preSorted(e.slice(0,o),t,n),a=H.preSorted(e.slice(o+1),t,n),[c,u]=e[o];return new I(t,c,u,s,a)}}}};ct.AVLTree=H;var jn=class extends H{constructor(e){super(e);this.isEmpty=!0,this.height=0,this.balance=0}insert(e,t){return new I(this.comparator,e,t,this,this)}contains(e){return!1}lookup(e){}delete(e){return{tree:this}}first(){}last(){}removeFirst(){return{tree:this}}removeLast(){return{tree:this}}toString(){return""}*keys(){}*values(){}*entries(){return[]}},I=class extends H{constructor(e,t,n,i,o){super(e);this.key=t,this.value=n,this.left=i,this.right=o,this.isEmpty=!1}insert(e,t){let n=this.comparator(e,this.key);return n===0?new I(this.comparator,e,t,this.left,this.right):n<0?this.replaceLeft(this.left.insert(e,t)):this.replaceRight(this.right.insert(e,t))}contains(e){let t=this.comparator(e,this.key);return t===0?!0:t<0?this.left.contains(e):this.right.contains(e)}lookup(e){let t=this.comparator(e,this.key);return t===0?this.value:t<0?this.left.lookup(e):this.right.lookup(e)}delete(e){let t=this.comparator(e,this.key);if(t===0){if(this.left.isEmpty)return{tree:this.right,key:this.key,value:this.value};if(this.right.isEmpty)return{tree:this.left,key:this.key,value:this.value};let{tree:s,key:a,value:c}=this.left.removeLast();return{tree:tr(new I(this.comparator,a,c,s,this.right)),key:this.key,value:this.value}}if(t<0){let{tree:s,key:a,value:c}=this.left.delete(e);return{tree:this.replaceLeft(s),key:a,value:c}}let{tree:n,key:i,value:o}=this.right.delete(e);return{tree:this.replaceRight(n),key:i,value:o}}first(){return this.left.isEmpty?this.value:this.left.first()}last(){return this.right.isEmpty?this.value:this.right.last()}removeFirst(){if(this.left.isEmpty)return{tree:this.right,key:this.key,value:this.value};let{tree:e,key:t,value:n}=this.left.removeFirst();return{tree:this.replaceLeft(e),key:t,value:n}}removeLast(){if(this.right.isEmpty)return{tree:this.left,key:this.key,value:this.value};let{tree:e,key:t,value:n}=this.right.removeLast();return{tree:this.replaceRight(e),key:t,value:n}}replaceLeft(e){return tr(new I(this.comparator,this.key,this.value,e,this.right))}replaceRight(e){return tr(new I(this.comparator,this.key,this.value,this.left,e))}toString(){return`(${this.left} ${this.key}=${this.value} ${this.right})`}get balance(){return this.left.height-this.right.height}get height(){return Math.max(this.left.height,this.right.height)+1}*keys(){yield*this.left.keys(),yield this.key,yield*this.right.keys()}*values(){yield*this.left.values(),yield this.value,yield*this.right.values()}*entries(){yield*this.left.entries(),yield[this.key,this.value],yield*this.right.entries()}};Rn.__decorate([Mn.lazy],I.prototype,"balance",null);Rn.__decorate([Mn.lazy],I.prototype,"height",null);function tr(r){let e=r.balance;return e==-2?ns(r):e==2?rs(r):r}function rs(r){let e=r.left.balance;return e==-1?is(r):e==1?En(r):r}function ns(r){let e=r.right.balance;return e==1?os(r):e==-1?Dn(r):r}function En(r){return Ln(r)}function is(r){let e=qn(r.left);return En(r.replaceLeft(e))}function Dn(r){return qn(r)}function os(r){let e=Ln(r.right);return Dn(r.replaceRight(e))}function qn(r){let e=r.right,t=e.left,n=r.replaceRight(t);return e.replaceLeft(n)}function Ln(r){let e=r.left,t=e.right,n=r.replaceLeft(t);return e.replaceRight(n)}});var Kn=y(he=>{"use strict";Object.defineProperty(he,"__esModule",{value:!0});he.unique=he.UniqueTransducer=void 0;var Ke=v(),ss=M(),Nn=Hn(),rr=class{constructor(e){this.comparator=e}async_(e){return Ke.__asyncGenerator(this,arguments,function*(){var n,i;let o=Nn.AVLTree.empty(this.comparator);try{for(var s=Ke.__asyncValues(e),a;a=yield Ke.__await(s.next()),!a.done;){let c=a.value;o.contains(c)||(o=o.insert(c,void 0),yield yield Ke.__await(c))}}catch(c){n={error:c}}finally{try{a&&!a.done&&(i=s.return)&&(yield Ke.__await(i.call(s)))}finally{if(n)throw n.error}}})}*sync(e){let t=Nn.AVLTree.empty(this.comparator);for(let n of e)t.contains(n)||(t=t.insert(n,void 0),yield n)}};he.UniqueTransducer=rr;function as(r=ss.ascending){return new rr(r)}he.unique=as});var Fn=y(xe=>{"use strict";Object.defineProperty(xe,"__esModule",{value:!0});xe.WindowedTransducer=xe.windowed=void 0;var be=v();function cs(r,e=1,t=!1){return new nr(r,e,t)}xe.windowed=cs;var nr=class{constructor(e,t,n){this.size=e,this.step=t,this.remainder=n}async_(e){return be.__asyncGenerator(this,arguments,function*(){var n,i;let o=[],s=0;try{for(var a=be.__asyncValues(e),c;c=yield be.__await(a.next()),!c.done;){let u=c.value;if(s>0){s--;continue}o.push(u),o.length===this.size&&(yield yield be.__await([...o]),o=o.slice(this.step),this.step>this.size&&(s=this.step-this.size))}}catch(u){n={error:u}}finally{try{c&&!c.done&&(i=a.return)&&(yield be.__await(i.call(a)))}finally{if(n)throw n.error}}this.remainder&&(yield yield be.__await([...o]))})}*sync(e){let t=[],n=0;for(let i of e){if(n>0){n--;continue}t.push(i),t.length===this.size&&(yield[...t],t=t.slice(this.step),this.step>this.size&&(n=this.step-this.size))}this.remainder&&(yield[...t])}};xe.WindowedTransducer=nr});var Wn=y(U=>{"use strict";Object.defineProperty(U,"__esModule",{value:!0});U.zipWithIndex=U.zip=U.ZipTransducer=void 0;var ut=v(),Gn=M(),us=it(),dt=class{constructor(e){this.other=e}async_(e){return ut.__asyncGenerator(this,arguments,function*(){if(!(0,Gn.isAsyncIterable)(this.other))throw new Error("Unsupported operation exception");let n=e[Symbol.asyncIterator](),i=this.other[Symbol.asyncIterator]();for(;;){let[o,s]=yield ut.__await(Promise.all([n.next(),i.next()]));if(o.done||s.done)return yield ut.__await(void 0);yield yield ut.__await([o.value,s.value])}})}*sync(e){if(!(0,Gn.isIterable)(this.other))throw new Error("Unsupported operation exception");let t=e[Symbol.iterator](),n=this.other[Symbol.iterator]();for(;;){let i=t.next(),o=n.next();if(i.done||o.done)return;yield[i.value,o.value]}}};U.ZipTransducer=dt;function ds(r){return new dt(r)}U.zip=ds;function ls(){return new dt((0,us.range)(0))}U.zipWithIndex=ls});var He=y(b=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0});var x=v();x.__exportStar(Me(),b);x.__exportStar(tn(),b);x.__exportStar(nn(),b);x.__exportStar(on(),b);x.__exportStar(sn(),b);x.__exportStar(Qe(),b);x.__exportStar(cn(),b);x.__exportStar(Ht(),b);x.__exportStar(un(),b);x.__exportStar(ln(),b);x.__exportStar(Gt(),b);x.__exportStar(pn(),b);x.__exportStar(fn(),b);x.__exportStar(gn(),b);x.__exportStar(Vt(),b);x.__exportStar(xn(),b);x.__exportStar(Pn(),b);x.__exportStar(Sn(),b);x.__exportStar(An(),b);x.__exportStar(Cn(),b);x.__exportStar(Kn(),b);x.__exportStar(Fn(),b);x.__exportStar(Wn(),b)});var or=y(_e=>{"use strict";Object.defineProperty(_e,"__esModule",{value:!0});_e.caching=_e.cache=void 0;function fs(r,e,t){if(typeof t.value!="function")throw new Error("@cache can only decorate methods");let n=new WeakMap;function i(o){let s=n.get(o);if(s)return s;let a=new Map;return n.set(o,a),a}return Object.defineProperty(r,e,Object.assign(Object.assign({},t),{value:function(...o){let s=JSON.stringify(o),a=i(this),c=a.get(s);if(typeof c!="undefined"||a.has(s))return c;let u=t.value.call(this,...o);return a.set(s,u),u}}))}_e.cache=fs;function gs(r){let e=new Map;return function(...t){let n=JSON.stringify(t),i=e.get(n);if(typeof i!="undefined"||e.has(n))return i;let o=r(...t);return e.set(n,o),o}}_e.caching=gs});var ki=y(p=>{"use strict";Object.defineProperty(p,"__esModule",{value:!0});p.Uri=p.HostHandler=p.host=p.replace=p.const_=p.modify=p.notFound=p.ok=p.response=p.delete_=p.patch=p.put=p.post=p.get=p.request=p.stringChunk=p.StringBody=p.isBody=void 0;var Si=v();typeof Symbol.asyncIterator=="undefined"&&(Symbol.asyncIterator=Symbol.for("Symbol.asyncIterator"));function Ls(r){return typeof r=="object"&&"text"in r&&Symbol.asyncIterator in r}p.isBody=Ls;var xt=class{constructor(e){this.value=e}text(){return Promise.resolve(this.value)}[Symbol.asyncIterator](){return Si.__asyncGenerator(this,arguments,function*(){yield yield Si.__await(Ai(this.value))})}};p.StringBody=xt;function Ai(r){return{text:()=>r,data:()=>new TextEncoder().encode(r)}}p.stringChunk=Ai;function Se(r,e,t,n){return{method:r,uri:typeof e=="string"?new Ae(e):e,headers:t||{},body:typeof n=="string"?new xt(n):n}}p.request=Se;function Hs(r,e){return Se("GET",r,e)}p.get=Hs;function Ns(r,e,t){return Se("POST",r,e,t)}p.post=Ns;function Ks(r,e,t){return Se("PUT",r,e,t)}p.put=Ks;function Fs(r,e,t){return Se("PATCH",r,e,t)}p.patch=Fs;function Gs(r,e){return Se("DELETE",r,e)}p.delete_=Gs;function xr(r,e,t){return{status:r,headers:e||{},body:typeof t=="string"?new xt(t):t}}p.response=xr;function Ws(r,e){return xr(200,r,e)}p.ok=Ws;function Us(r,e){return xr(404,r,e)}p.notFound=Us;function vr(r,e,t){return Object.assign({},r,{[e]:t(r[e])})}p.modify=vr;function Oi(r){return()=>r}p.const_=Oi;function Ci(r,e){return t=>vr(t,r,Oi(e))}p.replace=Ci;function Vs(r){if(typeof r.uri.authority!="undefined")return r.uri.authority;let e=r.headers.Host;if(typeof e!="string")throw new Error("Bad Request");return e}p.host=Vs;var Ii=class{constructor(e,t){this.handler=e,this.host=t}handle(e){return this.handler.handle(vr(e,"headers",Ci("Host",this.host)))}};p.HostHandler=Ii;var Ae=class{constructor(e){let t=Ae.RFC_3986.exec(e);if(!t)throw new Error(`Invalid Uri: ${e}`);let[,,n,,i,o,,s,,a]=t;this.scheme=n,this.authority=i,this.path=o,this.query=s,this.fragment=a}toString(){let e=[];return typeof this.scheme!="undefined"&&e.push(this.scheme,":"),typeof this.authority!="undefined"&&e.push("//",this.authority),e.push(this.path),typeof this.query!="undefined"&&e.push("?",this.query),typeof this.fragment!="undefined"&&e.push("#",this.fragment),e.join("")}toJSON(){return this.toString()}};p.Uri=Ae;Ae.RFC_3986=/^(([^:/?#]+):)?(\/\/([^/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?/});var Un=q(He()),Vn=q(M()),ps=q(He());function ir(r){switch(typeof r){case"undefined":return!0;case"string":return r.trim()==="";case"number":return isNaN(r);case"object":{if(r==null)return!0;if(h.isObject(r))return Object.keys(r).length===0;if(Array.isArray(r))return r.length===0}}return!1}var we=class{static noWhitespace(e){return e&&typeof e=="string"?e.replace(/\s+/g,""):""}static startWith(e,t){return e?e.substring(0,t.length)===t:e===t}static endsWith(e,t){return e.substring(e.length-t.length,e.length)===t}static isEmpty(e){return e===void 0||e===null?!0:e.trim().length===0}static isEmail(e){return typeof e=="string"&&this.validEmailPattern.test(e)}static isLowerCase(e){return e===e.toLowerCase()&&e!==e.toUpperCase()}static isUpperCase(e){return e===e.toUpperCase()&&e!==e.toLowerCase()}static kebabCase(e){return we.delimiterCase(e,"-")}static snakeCase(e){return we.delimiterCase(e,"_")}static delimiterCase(e,t){return e.replace(/([A-Z][a-z]+|\d+)/gm,`${t}$1`).replace(new RegExp(`^${t}`),"").toLowerCase()}static titleCase(e){return we.isEmpty(e)?"":e.replace(/\w\S*/g,t=>t.charAt(0).toUpperCase()+t.substr(1).toLowerCase())}static camelCase(e){return we.isEmpty(e)?"":e.replace(/([A-Za-z]+|\d+)/gm,t=>t.charAt(0).toUpperCase()+t.substr(1).toLowerCase()).replace(new RegExp("^."),t=>t.toLowerCase()).replace(new RegExp(/[_\-\s]/g),"")}},ve=we;ve.validEmailPattern=/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+$/;function Fe(r,e,t){if(e(r))return t(r);switch(typeof r){case"undefined":return;case"object":{if(r===null)return null;if(Array.isArray(r))return r.map(n=>Fe(n,e,t));if(h.isObject(r))return h.keys(r).sort().reduce((n,i)=>{let o=r[i];return n[i]=Fe(o,e,t),n},{})}}return r}function lt(r,e){switch(typeof r){case"undefined":return;case"object":{if(r===null)return null;if(Array.isArray(r))return r.map(t=>lt(t,e));if(h.isObject(r))return h.keys(r).sort().reduce((t,n)=>{let i=r[n];return t[e(String(n))]=lt(i,e),t},{})}}return r}var h=class{static isObject(e){return e&&typeof e=="object"&&(e.constructor===Object||/Object.*native/.test(e.constructor.toString()))}static keys(e){return Object.keys(e)}static values(e){return Object.keys(e).map(t=>e[t])}static entries(e){return Object.keys(e).map(t=>[t,e[t]])}static removeEmpty(e){return e&&(h.isObject(e)?Object.keys(e).reduce((t,n)=>{let i=h.removeEmpty(e[n]);return ir(i)||(t[n]=i),t},{}):e)}static sort(e){return e&&(Array.isArray(e)?e.map(h.sort):h.isObject(e)?Object.keys(e).sort().reduce((t,n)=>{let i=e[n];return t[n]=h.sort(i),t},{}):e)}static toLowerCase(e){return typeof e=="string"?e.toLowerCase():Array.isArray(e)?e.map(h.toLowerCase):l(()=>h.isObject(e))?Object.entries(e).reduce((t,[n,i])=>(t[n]=h.toLowerCase(i),t),{}):e}static snakeCase(e){return lt(e,ve.snakeCase)}static camelCase(e){return lt(e,ve.camelCase)}static filter(e,t){let n=h.keys(e).filter(t);return h.pick(e,...n)}static omit(e,...t){return t.reduce((n,i)=>(Reflect.deleteProperty(n,i),n),e)}static pick(e,...t){return t.reduce((n,i)=>(n[i]=e[i],n),{})}};var k=class{static from(e){return Array.from(e)}static find(e,t){if(e.find)return e.find(t);let[n]=e.filter(t);return n}static findLastIndex(e,t){let n=[...e].reverse().findIndex(t);return n===-1?n:e.length-n-1}static toObject(e){return e.reduce((t,n)=>(Object.keys(n).forEach(i=>{i in t||(t[i]=n[i])}),t),{})}static flatten(e){return e.reduce((t,n)=>t.concat(n),[])}static flatMap(e,t){return e.flatMap?e.flatMap(t):k.flatten(e.map(t))}static unique(e){return Array.from(new Set(e))}static clean(e){return e.filter(Boolean)}static trim(e){return e.map(t=>t.trim())}static includes(e,t){return"includes"in e?e.includes(t):e.indexOf(t)!==-1}static first(e){return e[0]}static last(e){return e[e.length-1]}static safeReverse(e){return e?e.slice().reverse():[]}static shuffle(e){return e.map(t=>({value:t,order:Math.random()})).sort((0,Vn.by)("order")).map(({value:t})=>t)}};function l(r,e=void 0){try{let t=r();return typeof t=="undefined"?e:t}catch(t){return e}}function zn(r,e=void 0){return f(this,null,function*(){try{let t=yield r();return typeof t=="undefined"?e:t}catch(t){return e}})}var j=(()=>typeof self!="undefined"?self:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof module!="undefined"?module:Function("return this")())();function Bn(r,e,t){let n=r[e];return typeof n=="undefined"?r[e]=t:Array.isArray(n)?n.indexOf(t)==-1&&n.push(t):r[e]=[n,t],r}function $n(r,e,t,n=i=>i){let i=[],o=0,s;for(;(s=r.exec(e))!=null;)i.push(n(e.substring(o,s.index))),i.push(t(s)),o=r.lastIndex;return i.push(n(e.substring(o))),i.join("")}var Jn=q(or()),Zn=q(er());function $(r=j){return r.triptease=r.triptease||{},r.triptease.onboard=r.triptease.onboard||{},{triptease:r.triptease,onboard:r.triptease.onboard}}var J;(function(n){n.Native="native",n.NonNative="non-native",n.NotImplemented="not-implemented"})(J||(J={}));function Yn(r,e){return l(()=>e.split(".").reduce((t,n)=>t[n],r))}function ys(r){return r==null?J.NotImplemented:typeof r=="function"?r.toString().includes("native code")?J.Native:J.NonNative:J.Native}var pt=class{static exposeApi(){let e=$(j).triptease;e.native||(e.native=pt)}static getProperty(e){let t=Yn(j,e);return ys(t)!==J.NonNative?t:Yn(pt.window,e)}static get window(){let e=j;if(!e.document)return e;try{let t=e.document,n=t.querySelector("[name='triptease.native']");if(n)return n.contentWindow;let i=t.createElement("iframe");return i.style.display="none",i.setAttribute("title","blank"),i.setAttribute("aria-hidden","true"),i.setAttribute("name","triptease.native"),t.documentElement.appendChild(i),i.contentWindow}catch(t){return e}}},T=pt;Re([Jn.cache],T,"getProperty",1),Re([Zn.lazy],T,"window",1);var ms=/^\d{4}-\d{2}-\d{2}(?:T\d{2}:\d{2}:\d{2}\.\d{3}Z)?$/;function hs(r){return Fe(r,e=>typeof e=="string"&&ms.test(e),e=>{let t=new Date(e);return isNaN(t.valueOf())?e:t})}var bs=T.getProperty("JSON.parse"),Qn=T.getProperty("JSON.stringify"),xs=T.getProperty("Date.prototype.toISOString"),vs=T.getProperty("atob"),ws=T.getProperty("btoa"),E=class{static parse(e){return bs(e)}static parseWithDates(e){return hs(E.parse(e))}static stringify(e){return Qn(this.clean(e))}static clean(e){return Fe(e,t=>{let n=typeof t;switch(n){case"undefined":case"string":case"number":case"boolean":return!0;case"object":{if(t===null)return!0;if(Array.isArray(t)||h.isObject(t))return!1;if("toJSON"in t)return!0}}throw new Error(`Illegal JsonValue: ${n} ${t} `)},t=>t instanceof Date?xs.call(t):t)}static atob(e){try{let t=vs(e);return E.parseWithDates(t)}catch(t){}}static btoa(e){try{if(!h.isObject(e))return;let t=Qn(e);return ws(t)}catch(t){}}},R=class{static same(e,t){return E.stringify(e)===E.stringify(t)}static isSuperset(e,t){return e===null||t===null?R.same(e,t):Array.isArray(e)&&Array.isArray(t)?e.length>t.length?!1:e.every(n=>t.some(i=>R.isSuperset(n,i))):l(()=>h.isObject(e))&&l(()=>h.isObject(t))?Object.keys(e).reduce((n,i)=>n&&R.isSuperset(e[i],t[i]),!0):R.same(e,t)}static compress(e){let t=R.groupValues(e);return this.compressGrouped(t)}static compressGrouped(e){return Object.entries(e).reduce(({shared:t,unique:n},[i,o])=>{if(l(()=>h.isObject(o))){let s=R.compressGrouped(o);Object.keys(s.shared).length>0&&(t[i]=s.shared),s.unique.forEach((a,c)=>{n[c]=n[c]||{},Object.keys(a).length>0&&(n[c][i]=a)})}return Array.isArray(o)&&o.forEach((s,a)=>{n[a]=n[a]||{},k.unique(o.map(c=>E.stringify(c))).length===1?t[i]=s:s!==void 0&&(n[a][i]=s)}),{shared:t,unique:n}},{shared:{},unique:[]})}static groupValues(e){let t=Array.from(e.reduce((s,a)=>Object.keys(a).reduce((c,u)=>c.add(u),s),new Set)),[n,i]=e.reduce((s,a)=>t.reduce(([c,u],m)=>{let A=a[m];return l(()=>h.isObject(A))?(u[m]=u[m]||[],u[m].push(A)):(c[m]=c[m]||[],c[m].push(A)),[c,u]},s),[{},{}]),o=Object.entries(i).reduce((s,[a,c])=>(s[a]=R.groupValues(c),s),{});return C(C({},n),o)}static decompress(e){return e.unique.map(t=>this.merge(e.shared,t))}static merge(e,t){return[...Object.keys(e),...Object.keys(t)].reduce((i,o)=>{let s=e[o],a=t[o];return l(()=>h.isObject(s))&&l(()=>h.isObject(a))?i[o]=R.merge(s,a):i[o]=a!=null?a:s,i},{})}};function Ge(r,e=!0){return r?(r.indexOf("?")==0&&(r=r.substring(1,r.length)),r.split("&").map(function(t){return t.split("=")}).reduce(function(t,n){let i=n[0],o=n[1];if(!i)return t;let s=Xn(o),a=e?_s(s):s;return Bn(t,Xn(i),a)},{})):{}}function Xn(r){return l(()=>decodeURIComponent(r.replace(/\+/g,"%20")),r)}function _s(r){try{return E.parse(r)}catch(e){return r}}function Ts(r){return typeof r=="string"?r:JSON.stringify(r)}function ei(r,e=!0){return Object.keys(h.removeEmpty(r)).map(t=>{let n=r[t],i=e?Ts(n):n;return`${t}=${encodeURIComponent(i)}`}).join("&")}var ar=class{constructor(e){let t=ar.RFC_3986.exec(e);if(!t)throw new Error(`Invalid Uri: ${e}`);let[,,n,,i,o,,s,,a]=t;this.scheme=n,this.authority=i?new sr(i):void 0,this.path=o,this.query=s,this.fragment=a}toString(){let e=[];return typeof this.scheme!="undefined"&&e.push(this.scheme,":"),typeof this.authority!="undefined"&&e.push("//",this.authority.toString()),e.push(this.path),typeof this.query!="undefined"&&e.push("?",this.query),typeof this.fragment!="undefined"&&e.push("#",this.fragment),e.join("")}get host(){return this.authority&&this.authority.host}get port(){return this.authority&&this.authority.port}get userInfo(){return this.authority&&this.authority.userInfo}},Te=ar;Te.RFC_3986=/^(([^:/?#]+):)?(\/\/([^/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?/;var cr=class{constructor(e){let t=cr.RFC_3986.exec(e);if(!t)throw new Error(`Invalid Authority: ${e}`);let[,n,i,o]=t;this.userInfo=n,this.host=i,this.port=o}toString(){let e=[];return typeof this.userInfo!="undefined"&&e.push(this.userInfo,"@"),typeof this.host!="undefined"&&e.push(this.host),typeof this.port!="undefined"&&e.push(":",this.port),e.join("")}},sr=cr;sr.RFC_3986=/(?:([^@]+)@)?([^:]+)(?::([\d]+))?/;var ti=T.getProperty("console.log"),Ps=T.getProperty("console.error"),Ss=T.getProperty("console.debug"),ri=class{constructor(e=ti,t=Ps,n=Ss||ti){this.log=e;this.error=t;this.debug=n}},ni=class{constructor(){this.log=()=>{};this.error=()=>{};this.debug=()=>{}}},ft="triptease-debug",As=256;function ii(r,e=ft){let t=l(()=>{var n;return Ge((n=r.location)==null?void 0:n.search,!1)[e]})||l(()=>{var n;return Ge(new Te((n=r.location)==null?void 0:n.originalHref).query,!1)[e]})||l(()=>{var n,i;return(i=(n=r.process)==null?void 0:n.env)==null?void 0:i.DEBUG})||l(()=>{var n;return((n=r.localStorage)==null?void 0:n.getItem)&&r.localStorage.getItem(e)})||l(()=>{var n;return((n=r.sessionStorage)==null?void 0:n.getItem)&&r.sessionStorage.getItem(e)})||"";return l(()=>t.substring(0,As),"")}function oi(r=j){let e=ii(r,ft);return ve.isEmpty(e)?"":ei({[ft]:e})}function Os(r){return ii(r,ft).split(",").map(e=>e.trim())}function si(r){let e=r.replace(/\./g,"\\.").replace(/\*/g,".*");return new RegExp("^"+e+"$")}function Cs(r,e=j){try{let t=Os(e),n=t.filter(i=>i[0]==="!").map(i=>i.substr(1));return n.length>0?!n.some(i=>si(i).test(r)):t.some(i=>i==="true"||si(i).test(r))}catch(t){return!1}}var Z;(function(n){n[n.DEBUG=0]="DEBUG",n[n.INFO=1]="INFO",n[n.ERROR=2]="ERROR"})(Z||(Z={}));var ai=class{constructor(e,t,n=new ri){this.name=e;this.logLevel=t;this.console=n}debug(e,...t){this.logLevel.valueOf()>0||this.console.debug(`[${this.name}] ${e}`,...t)}log(e,...t){this.logLevel.valueOf()>1||this.console.log(`[${this.name}] ${e}`,...t)}error(e,...t){this.logLevel.valueOf()>2||this.console.error(`[${this.name}] ${e}`,...t)}};function P(r,e=j){let t=l(()=>{var n,i,o;return Z[((o=(i=(n=e.process)==null?void 0:n.env)==null?void 0:i.LOG_LEVEL)==null?void 0:o.toUpperCase())||"DEBUG"]},0);return Cs(r,e)?new ai(r,t):new ni}var ec=T.getProperty("Date");var ur=class{now(){return new Date}};function ci(r){return new Promise(e=>{this.setTimeout(()=>{e()},r)})}var dr=class{constructor(e=new ur){this.clock=e;this.delay=ci.bind(this);this.delay=ci}task(e){return f(this,null,function*(){return yield this.delay(0),e()})}setTimeout(e,t){return setTimeout(e,t)}clearTimeout(e){clearTimeout(e)}setInterval(e,t){return setInterval(e,t)}clearInterval(e){clearInterval(e)}requestIdleCallback(e,t){let n=t?t.timeout:1,i=this.clock.now().getTime()+n,o=this;return this.setTimeout(()=>{e({didTimeout:!1,timeRemaining(){return Math.max(0,50-(o.clock.now().getTime()-i))}})},n)}cancelIdleCallback(e){this.clearTimeout(e)}};var ic=new dr;function ui(r={credentials:!1}){return e=>f(this,null,function*(){if(typeof fetch!="undefined"){let t=yield fetch(e.url,{method:e.method,headers:e.headers,body:e.body,credentials:r.credentials?"include":"omit"});return{status:t.status,statusDescription:t.statusText,body:yield t.text()}}else{let t=new XMLHttpRequest;return t.open(e.method,e.url,!0),e.headers&&Object.keys(e.headers).forEach(n=>{t.setRequestHeader(n,e.headers[n])}),t.withCredentials=r.credentials,t.send(e.body),new Promise((n,i)=>{t.addEventListener("load",o=>{n({status:t.status,statusDescription:t.statusText,body:t.responseText})}),t.addEventListener("error",o=>{i(o)})})}})}var li=q(or());var Is=/\${([^}]+)}/g;function di(r,e){return $n(Is,r,([,t])=>{var n;return(n=e[t])!=null?n:`\${${t}}`})}var lr=class{static get(){return l(()=>{let e="9195.136023";return e?"v"+e:"latest"})}};var pi=class{constructor(e,t=ui()){this.logger=e;this.httpHandler=t;this.workers={}}createWorker(e,t){return f(this,null,function*(){let n=this.workers[e];return n||(this.workers[e]=yield this.create(t,{name:e}))})}create(e,t){return f(this,null,function*(){try{return new Worker(e,t)}catch(n){this.logger.debug("Failed to create Worker switching to Blob Worker because:",n.message);let i=`location.originalHref = "${e}";
`,s=(yield this.httpHandler({method:"GET",url:e})).body,a=new Blob([i,s],{type:"application/javascript"});return new Worker(URL.createObjectURL(a),t)}})}},gt=class{constructor(e,t=P("application-starter"),n=new pi(t),i=new fi(e,t)){this.window=e;this.logging=t;this.workerFactory=n;this.waiter=i}start(e){return f(this,null,function*(){this.logging.debug(`ApplicationStarter starting app "${e.name}" (${e.type}), ${e.url}`);let t=this.window.document;if(e.type==="worker"){let o=yield this.workerFactory.createWorker(e.name,e.url);return e.startMessage&&(yield this.waiter.waitForMessage(e.startMessage,o)),this.logging.debug("ApplicationStarter returning worker"),o}let n=t.createElement(e.type);n.setAttribute("name",e.name),n.src=di(e.url,{onboard_version:lr.get()});let i=gt.DefaultOptions[e.type]||{};return Object.keys(i).forEach(o=>{n.setAttribute(o.toLowerCase(),i[o])}),this.addElement(n),e.startMessage?yield this.waiter.waitForMessage(e.startMessage):e.type==="script"&&(yield this.waiter.waitForLoadEvent(n)),n})}addElement(e){(this.window.document.body||this.window.document.documentElement).appendChild(e)}static create(e){var n;let t=$(e).triptease.onboard;return t.applicationStarter=(n=t.applicationStarter)!=null?n:new gt(e)}},We=gt;We.DefaultOptions={script:{defer:"",async:"",crossOrigin:"anonymous"},iframe:{style:"display: none;",sandbox:"allow-scripts allow-same-origin",title:"blank","aria-hidden":"true"}},Re([li.cache],We.prototype,"start",1);var fi=class{constructor(e,t){this.window=e;this.logging=t}waitForLoadEvent(e){return this.logging.debug("MessageWaiter waiting for load/error event for",e),new Promise((t,n)=>{e.addEventListener("load",t),e.addEventListener("error",i=>n({name:"ScriptError",message:i.message||`Failed to load script "${e.src}"`}))})}waitForMessage(e,t=this.window){return this.logging.debug("MessageWaiter waiting for message",e),new Promise(n=>{this.logging.debug("MessageWaiter creating handler");let i=o=>{try{let s=o.data&&o.data.type,a=s===e;this.logging.debug(`ApplicationStarter message received "${s}", expecting "${e}", matched: ${a}`),a&&(t.removeEventListener("message",i),n(o.data))}catch(s){this.logging.debug("ApplicationStarter error in parsing message",s,o)}};this.logging.debug("MessageWaiter adding listener"),t.addEventListener("message",i)})}};var Pc=new Set(["Unknown","PossibleIdentifier"]),Sc=new Set(["HotelName","HotelCode","ChainCode"]);var D;(function(u){u.Search="Search",u.RoomsAndRates="RoomsAndRates",u.Confirmation="Confirmation",u.Checkout="Checkout",u.Payment="Payment",u.Group="Group",u.Advert="Advert",u.Partial="Partial",u.Unknown="Unknown"})(D||(D={}));var ks=[D.Payment,D.Confirmation,D.RoomsAndRates,D.Checkout,D.Search,D.Partial,D.Group,D.Unknown,D.Advert];function gi(r){return ks.indexOf(r)}var yi;(function(i){i.Room="Room",i.Fee="Fee",i.Tax="Tax",i.Unknown="Unknown"})(yi||(yi={}));var N;(function(n){n.Singleton="Singleton",n.ApplicationHost="ApplicationHost",n.DataSource="DataSource"})(N||(N={}));var mi;(function(i){i.PENDING="Pending",i.SKIPPED="Skipped",i.FAILED="Failed",i.PASSED="Passed"})(mi||(mi={}));var hi;(function(o){o.SCRIPT_PRESENT="Script Present",o.SCRIPT_LOADED="Script Loaded",o.INTEGRATION_ID_MATCHES="Integration Id Matches",o.PAGE_EVALUATED="Page Evaluated",o.MESSAGING_ACTIVE="Messaging Active"})(hi||(hi={}));var Ue="triptease.onboard.kernel",bi;(function(i){i.Enabled="Enabled",i.Disabled="Disabled",i.Strict="Strict",i.NotConfigured="NotConfigured"})(bi||(bi={}));function Rs(r,e,t){return Object.defineProperty(r,e,{value:t})}function xi(r,e,t){return Rs(r,e,t)[e]}function vi(r){try{let{target:e,method:t}=fr(r.type);if(e&&t)return!0}catch(e){}return!1}var yt=class{constructor(e,t=P("worker")){this.worker=e;this.logger=t}addListener(e){this.worker.addEventListener("message",t=>{!vi(t.data)||e(t.data,this)})}send(e){try{this.worker.postMessage(e)}catch(t){this.worker.postMessage(JSON.parse(JSON.stringify(e)))}}},Pe=class{constructor(e,t,n=pr,i=P("messaging")){this.listener=e;this.allowedOrigins=n;this.logger=i;this.target=this.listener!==t?t:void 0}addListener(e){this.listener&&this.listener.addEventListener("message",t=>{this.disallowedOrigin(t)||!vi(t.data)||e(t.data,new Pe(void 0,t.source||this.target))})}disallowedOrigin(e){return e.origin&&this.allowedOrigins.length>0&&this.allowedOrigins.indexOf(new Te(e.origin).host)===-1}send(e){if(this.target)try{this.target.postMessage(e,"*")}catch(t){this.target.postMessage(JSON.parse(JSON.stringify(e)),"*")}}},pr=["onboard.triptease.io","localhost"],Ms=/^(.*)\.([^.]+)$/;function fr(r){let[,e,t]=r.match(Ms)||[];return{target:e,method:t}}function wi(r){return r&&typeof r=="object"&&"name"in r&&typeof r.name=="string"&&"message"in r&&typeof r.message=="string"&&"stack"in r&&typeof r.stack=="string"}function gr(r,e,t){return{name:r,message:e,stack:t!=null?t:""}}var Ri=q(He());var Mi=q(Zt()),Oe=q(M());var mt,js=new Uint8Array(16);function yr(){if(!mt&&(mt=typeof crypto!="undefined"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto!="undefined"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!mt))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return mt(js)}var _i=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function Es(r){return typeof r=="string"&&_i.test(r)}var Ti=Es;var w=[];for(ht=0;ht<256;++ht)w.push((ht+256).toString(16).substr(1));var ht;function Ds(r){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=(w[r[e+0]]+w[r[e+1]]+w[r[e+2]]+w[r[e+3]]+"-"+w[r[e+4]]+w[r[e+5]]+"-"+w[r[e+6]]+w[r[e+7]]+"-"+w[r[e+8]]+w[r[e+9]]+"-"+w[r[e+10]]+w[r[e+11]]+w[r[e+12]]+w[r[e+13]]+w[r[e+14]]+w[r[e+15]]).toLowerCase();if(!Ti(t))throw TypeError("Stringified UUID is invalid");return t}var Pi=Ds;function qs(r,e,t){r=r||{};var n=r.random||(r.rng||yr)();if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,e){t=t||0;for(var i=0;i<16;++i)e[t+i]=n[i];return e}return Pi(n)}var mr=qs;var hr=()=>l(()=>crypto.randomUUID())||mr(),br=class{generate(e){if(typeof e!="undefined")throw new Error("UuidGenerator does not support custom lengths");return hr().replace(/-/g,"")}};var Y=class{static get last(){return C({},Y.value)}static get(e,t,n,i,o){let s={clientKey:n,clientName:i,apiKey:o,pageType:e,pagePath:t};if(!ir(Y.value)&&l(()=>{let c=C({},Y.value);return delete c.pageVisitId,R.same(c,s)}))return Y.value;let a=ke(C({},s),{pageVisitId:hr()});return Y.value=a}},V=Y;V.value={};function bt(r,e=V.last){let i=e,{pageVisitId:t}=i,n=jr(i,["pageVisitId"]);return ke(C({},r),{context:C(C({},n),r.context||{}),pageVisitId:t})}var ji=q(ki());function*Ei(r){for(let e=0;e<r.frames.length;e++){let t=r.frames[e];yield t,yield*Ei(t)}}function zs(r,e){return(0,Mi.array)(Ei(r),(0,Ri.filter)(t=>l(()=>t.name)===e))}function Di(r){return r===r.top?0:1+Di(r.parent)}function wr(r){let[e]=r.sort((0,Oe.by)(Di,Oe.ascending));return e}function Bs(r){return r.map(e=>l(()=>{var t;return(t=e.triptease.message)==null?void 0:t.payload})).filter(Boolean)}function $s(r){let[e]=Bs(r).sort((0,Oe.by)(t=>gi(t.type),Oe.ascending));return e}function vt(r){return zs(r.top,Ue)}function _r(r,e=vt(r)){return e.length===1?N.Singleton:wr(e)===r?N.ApplicationHost:N.DataSource}function Tr(r){return l(()=>{var e;return new ji.Uri((e=r.context.page)==null?void 0:e.url).path})}function qi(r,e){let t=$s(r);return bt(ke(C({},e),{payload:t}),V.get(t.type,Tr(e),t.clientKey,t.clientName,t.apiKey))}function Pr(r){return r&&typeof r=="object"&&r.type==="triptease.onboard.request"&&typeof r.requestType=="string"&&typeof r.correlationId=="string"&&Array.isArray(r.payload)}function wt(r){return r&&typeof r=="object"&&r.type==="triptease.onboard.response"&&typeof r.correlationId=="string"}function _t(r,e){return{type:"triptease.onboard.response",correlationId:r,payload:e}}function Tt(r,e){return _t(r,gr("NotFound","No handler found for "+e))}function Li(r){return l(()=>r.payload.name==="NotFound",!1)}function Hi(r,e){return _t(r,gr(e.name,e.message,e.stack))}var Js=P("messaging"),Pt=class{constructor(){this.handlers=new Map}register(e,t){return e.forEach(n=>{if(this.hasHandlerFor(n))throw new Error(`Method name "${n}" already registered to a handler`);this.handlers.set(n,t)}),this}handle(e){return f(this,null,function*(){let t=this.handlers.get(e.requestType);return t?(Js.debug("Matched message to handler",e,t),yield t.handle(e)):Tt(e.correlationId,e.requestType)})}hasHandlerFor(e){return this.handlers.has(e)}};var Sr=P("messaging"),Ar=class{constructor(e){this.target=e}handle(e){return f(this,null,function*(){let t=this.target[e.requestType];if(!t)return Sr.debug("No method found that matches method",e.requestType,this.target),Tt(e.correlationId,e.requestType);try{Sr.debug("Found method",e.requestType);let n=yield t.apply(this.target,e.payload);return _t(e.correlationId,n)}catch(n){return Sr.debug("Error trying to in invoke method",e.requestType,n),Hi(e.correlationId,n)}})}};var Ni=class{constructor(e,t){this.messaging=e;this.idGenerator=t}get(e,t,n){return(...i)=>f(this,null,function*(){let o=this.idGenerator.generate(),{payload:s}=yield this.messaging.handle({type:"triptease.onboard.request",requestType:String(t),payload:i,correlationId:o});if(wi(s))throw s;return s})}};function St(r,e=new br){return new Proxy({},new Ni(r,e))}var Ki=P("messaging"),Ce=class{constructor(e){this.messageHandler=e;this.promises=new Map;e&&e.addListener(t=>{if(wt(t)){let{correlationId:n}=t,i=this.promises.get(n);i&&(Ki.debug("Sender matched response",t),i.resolve(t),this.promises.delete(n))}})}handle(e){return f(this,null,function*(){return Ki.debug("Sending request",e),this.messageHandler&&this.messageHandler.send(e),new Promise((t,n)=>{this.promises.set(e.correlationId,{resolve:t,reject:n})})})}};var At=class{constructor(e,t,n=P("messaging")){this.listen=e;this.router=t;this.logger=n;this.rules=[];e.addListener(this.handler.bind(this)),this.addRule(Pr,i=>i,i=>i),this.addRule(Ys,Xs,Fi)}registerAlias(e,t){if(!this.router.hasHandlerFor(t))throw new Error(`Illegal alias: Method "${t}" is not registered with router`);return this.addRule(Zs(e),Qs(t),Fi)}handler(e,t){return f(this,null,function*(){if(wt(e))return;this.logger.debug("listenOn received request",e);let n=this.rules.find(s=>s.predicate(e));if(!n)return;let i=n.requestConverter(e),o=yield this.router.handle(i);if(Li(o)){this.logger.debug(`Handler not found for request "${i.requestType}", potentially for another listener`);return}e.correlationId&&e.correlationId===o.correlationId&&(this.logger.debug("listenOn sending response to sender",o),t.send(n.responseConverter(o)))})}addRule(e,t,n){return this.rules.push({predicate:e,requestConverter:t,responseConverter:n}),this}};function Zs(r){return e=>e.type===r}function Ys(r){return!Pr(r)&&!!r.correlationId}function Qs(r){return e=>({type:"triptease.onboard.request",requestType:String(r),payload:[e],correlationId:e.correlationId||"fire-and-forget"})}function Xs(r){let{value:e,correlationId:t}=r,{method:n}=fr(r.type);return{type:"triptease.onboard.request",requestType:n,payload:[e],correlationId:t}}function Fi(r){return{type:"triptease.onboard.response",correlationId:r.correlationId,value:r.payload}}var Or=class{constructor(e){this.storage=e}get(e){let t=this.storage.getItem(e);if(t)return E.parseWithDates(t)}set(e,t){return this.storage.setItem(e,JSON.stringify(t)),this}clear(){this.storage.clear()}},Cr=class{constructor(){this.data=new Map}get(e){return this.data.get(e)}set(e,t){return this.data.set(e,t)}clear(){this.data.clear()}};var Ve=class{constructor(e){this.providers=e}static create(...e){return new Ve(e)}getAnonymousIds(){return f(this,null,function*(){return k.unique(k.flatten(yield Promise.all(this.providers.map(e=>l(()=>e.getAnonymousIds(),[])))))})}setAnonymousId(e){return f(this,null,function*(){yield Promise.all(this.providers.map(t=>l(()=>t.setAnonymousId(e))))})}syncAnonymousIds(e){return f(this,null,function*(){return k.unique(k.flatten(yield Promise.all(this.providers.map(t=>l(()=>t.syncAnonymousIds(e),[])))))})}};var Gi="triptease-anonymous-id",Ot=class{constructor(e){this.storage=e}getAnonymousIds(){return f(this,null,function*(){return this.get()})}setAnonymousId(e){return f(this,null,function*(){this.syncAnonymousIds([e])})}get(){let e=this.storage.get(Gi);return e?Array.isArray(e)?e.flat():[e]:[]}syncAnonymousIds(e){return f(this,null,function*(){let t=this.get(),n=k.unique([...t,...e].flat());return this.storage.set(Gi,n),n})}};var Ir=class{constructor(e,t,n=Ve.create(new Ot(new Cr),l(()=>new Ot(new Or(e.localStorage)))),i=P("kernel"),o=We.create(e)){this.window=e;this.allowedOrigin=t;this.identityProvider=n;this.logger=i;this.starter=o}get triptease(){let e=this.window.triptease=this.window.triptease||{};return e.onboard={"kernel-host":this},xi(this,"triptease",e)}start(){return f(this,null,function*(){this.logger.debug("KernelHost starting"),this.triptease;let e=new Pe(this.window,this.window.parent,[...pr,this.allowedOrigin],this.logger),t=yield this.starter.start(ea()),n=new yt(t),i=new Ce(n);this.kernel=St(i);let o=new Ce(e);this.bootstrap=St(o),this.kernelMode=yield this.getKernelMode(),this.logger.log(`Kernel Host is in ${this.kernelMode} mode`),new At(e,this.router=new Pt().register(["getPageState","getKernelMode","startApp","processConfig","getAnonymousIds","setAnonymousId","syncAnonymousIds","browserTopics"],new Ar(this)).register(["generateConfig","applicationConfig","generateClientConfig"],i)).registerAlias("triptease.config","processConfig"),new At(n,new Pt().register(["trackError","trackMessage"],o)),e.send({type:"triptease.onboard.kernel-host-started"}),this.logger.log("KernelHost started")})}startApp(e){return f(this,null,function*(){let t=yield this.starter.start(e),n=new Ce(new yt(t));this.router.register(e.requestTypes,n)})}getAnonymousIds(){return this.identityProvider.getAnonymousIds()}setAnonymousId(e){return f(this,null,function*(){yield this.identityProvider.setAnonymousId(e)})}syncAnonymousIds(e){return this.identityProvider.syncAnonymousIds(e)}getPageState(){return f(this,null,function*(){return V.last})}getKernelMode(){return f(this,null,function*(){let e=this.window,t=vt(e.top);return _r(e,t)})}processConfig(e){return f(this,null,function*(){let t=this.window;$(t).triptease.message=e;let n=vt(t.top),i=_r(t,n);switch(this.kernelMode!==i&&(this.kernelMode=i,this.bootstrap.updateKernelMode(i)),this.logger.log(`Kernel Host is in ${i} mode`),i){case N.Singleton:return this.bootstrap.processConfig(bt(e,V.get(e.payload.type,Tr(e),e.payload.clientKey,e.payload.clientName,e.payload.apiKey)));case N.ApplicationHost:let o=qi(n,e);return this.bootstrap.processConfig(o);case N.DataSource:let s=St(new Ce(new Pe(void 0,wr(n))));return this.logger.log("Sending triptease.config message to kernel host in application host mode",e.payload),s.processConfig(e)}})}browserTopics(){return zn(()=>this.window.document.browsingTopics())}};function ea(){return{name:Ue,url:`kernel.js?${oi()}`,type:"worker",startMessage:`${Ue}-started`,enabled:!0}}(()=>f(void 0,null,function*(){yield new Ir(window,Ge(location.search).originHost).start()}))();})();
//]]></script></head><body></body></html>