/**
 * Stackla is made available under a commercial licence
 * and is subject to Stackla's Terms of Service.
 *
 * Refer to https://stackla.com/terms-of-service/ 
 * or contact support@nosto.com for further clarification.
 *
 * Built on 2025-04-23 04:04:59
 */
window.Modernizr=((e,c,u)=>{function t(e){r.cssText=e}function p(e,t){return typeof e===t}function _(e,t){for(var i in e){i=e[i];if(!~(""+i).indexOf("-")&&r[i]!==u)return"pfx"!=t||i}return!1}function i(e,t,i,n){var o,a,r,s=c.createElement("div"),l=c.body,d=l||c.createElement("body");if(parseInt(i,10))for(;i--;)(a=c.createElement("div")).id=n?n[i]:f+(i+1),s.appendChild(a);return o=["&#173;",'<style id="s',f,'">',e,"</style>"].join(""),s.id=f,(l?s:d).innerHTML+=o,d.appendChild(s),l||(d.style.background="",d.style.overflow="hidden",r=g.style.overflow,g.style.overflow="hidden",g.appendChild(d)),o=t(s,e),l?s.parentNode.removeChild(s):(d.parentNode.removeChild(d),g.style.overflow=r),!!o}var n,o,a={},g=c.documentElement,f="modernizr",r=c.createElement(f).style,s=" -webkit- -moz- -o- -ms- ".split(" "),l="Webkit Moz O ms",h=l.split(" "),m=l.toLowerCase().split(" "),d={},w=[],v=w.slice,k={}.hasOwnProperty,y=void 0!==k&&void 0!==k.call?function(e,t){return k.call(e,t)}:function(e,t){return t in e&&void 0===e.constructor.prototype[t]};for(o in Function.prototype.bind||(Function.prototype.bind=function(i){var n=this;if("function"!=typeof n)throw new TypeError;var o=v.call(arguments,1),a=function(){var e,t;return this instanceof a?((e=function(){}).prototype=n.prototype,e=new e,t=n.apply(e,o.concat(v.call(arguments))),Object(t)===t?t:e):n.apply(i,o.concat(v.call(arguments)))};return a}),d.touch=function(){var t;return"ontouchstart"in e||e.DocumentTouch&&c instanceof DocumentTouch?t=!0:i(["@media (",s.join("touch-enabled),("),f,")","{#modernizr{top:9px;position:absolute}}"].join(""),function(e){t=9===e.offsetTop}),t},d)y(d,o)&&(n=o.toLowerCase(),a[n]=d[o](),w.push((a[n]?"":"no-")+n));return a.addTest=function(e,t){if("object"==typeof e)for(var i in e)y(e,i)&&a.addTest(i,e[i]);else{if(e=e.toLowerCase(),a[e]!==u)return a;t="function"==typeof t?t():t,g.className+=" "+(t?"":"no-")+e,a[e]=t}return a},t(""),0,a._version="2.6.3",a._prefixes=s,a._domPrefixes=m,a._cssomPrefixes=h,a.testProp=function(e){return _([e])},a.testAllProps=function(e,t,i){var n=e.charAt(0).toUpperCase()+e.slice(1),o=(e+" "+h.join(n+" ")+n).split(" ");if(p(t,"string")||void 0===t)return _(o,t);var a,r=(e+" "+m.join(n+" ")+n).split(" "),s=t,l=i;for(a in r){var d=s[r[a]];if(d!==u)return!1===l?r[a]:p(d,"function")?d.bind(l||s):d}return!1},a.testStyles=i,g.className=g.className.replace(/(^|\s)no-js(\s|$)/,"$1$2")+(" js "+w.join(" ")),a})(this,this.document),(()=>{window.Stackla=window.Stackla||{};var r=window.Stackla;r.createClass=function(){var e,t,i,n,o=function(){for(var e,t,i=this,n=[],o=[];i;)i.initializer&&n.push(i.initializer),i.destructor&&o.push(i.destructor),i=i.$parent;for(e=n.length-1;0<=e;e--)n[e].apply(this,arguments);this.destroy?(t=this.destroy,this.destroy=function(){for(e=o.length-1;0<=e;e--)o[e].apply(this,arguments);t.call(this)}):this.destroy=function(){for(e=o.length-1;0<=e;e--)o[e].apply(this,arguments)}},a=function(e,t){var i,n,o;for(n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);if(!Object.getOwnPropertyNames)for(n=0,o=(i=["toString","valueOf","toLocaleString","isPrototypeOf","propertyIsEnumerable","hasOwnProperty"]).length;n<o;n++)"function"==typeof t[i[n]]&&-1===t[i[n]].toString().indexOf("[native code]")&&(e[i[n]]=t[i[n]]);return e.$super=function(e){return this.$parent[e].apply(this.$parent,Array.prototype.slice.call(arguments,1))},e};if(arguments.length)return t="function"==typeof arguments[0]?(e=arguments[0],arguments[1]):arguments[0],e&&(a(o.prototype,e.prototype),o.prototype.$parent=e.prototype),a(o.prototype,t),(o.prototype.constructor=o).prototype.initializer||(o.prototype.initializer=function(){}),o.prototype.destructor||(o.prototype.destructor=function(){}),_.isString(arguments[arguments.length-1])&&("Stackla"===(i=arguments[arguments.length-1].split("."))[0]&&i.shift(),n=r,_.each(i,function(e,t){t===i.length-1?n[e]=o:_.isUndefined(n[e])&&(n[e]={}),n=n[e]})),o;throw new Error("You need to specify either parent class or methods object")},window.Stackla=r})(),(()=>{var e=Stackla.createClass({initializer:function(e){var t=this,i=t.getParams("debug");e=e||{},i?t.debug="true"===i||"1"===i:e.debug?t.debug=!0===e.debug:t.debug=!1,t._listeners=[]},toString:function(){return"Base"},log:function(e,t){var i,n=this.debug;!0!==n&&"1"!==n&&"true"!==n&&n!==this.toString()||(t=t||"info",window.console&&window.console[t]&&(this.toString()&&(i="["+this.toString()+"] "),"string"==typeof e?window.console[t](i+e):i?window.console[t](i,e):window.console[t](e)))},on:function(e,t){var i=this;if(e&&t)return i.log("on() - event '"+e+"' is subscribed"),i._listeners[e]||(i._listeners[e]=[]),(t.instance=i)._listeners[e].push(t),this;throw new Error("Both event type and callback are required parameters")},emit:function(e,t,i){var n,o=this,a=0;if(o.log("emit() - event '"+e+"' is triggered"),(t=t||[]).unshift({type:e,target:this}),!e)throw new Error("Lacks of type parameter");if(o._listeners[e]&&o._listeners[e].length)for(n in o._listeners[e])o._listeners[e].hasOwnProperty(n)&&(o._listeners[e][n].apply(this,t),a+=1);return 0!==a},getParams:function(e){var t=this.getUrl(),n={};return t.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(e,t,i){n[t]=i.replace(/[\/\^\*#!$&;:{}=\`~]/g,"")}),e?n[e]:n},getUrl:function(){return window.location.href},destroy:function(){var n=this;_.each(n._listeners,function(i){_.eachRight(i,function(e,t){e.instance===n&&i.splice(t,1)})})}});Stackla.Base=e})(),((e,t)=>{"object"==typeof module&&module.exports?module.exports=t():_.set(e,"Stackla.Display.Filter",t())})(this,function(){function i(e){return _.isObject(e)?_(e).omit(_.isUndefined).omit(_.isNull).map(function(e,t){return[t,i(e)]}).object().value():e}function n(e){return $.param(i(e))}function d(e){e=e||{};return e=_.pick(e,["brand","categories","draft_id","fallbacks","fallback_filter_id","product_link_attribute","filter_id","geohash","tag_group","available_products_only","limit","media","page","search","tags","data_tags","tags_grouped_as","tile_id","ttl","visible_on","wid"]),i(e=_.assign({tag_group:null,available_products_only:!1,draft_id:null,filter_id:null,limit:30,page:1,search:null,tags:null,data_tags:null,tags_grouped_as:null,tile_id:null,ttl:30,visible_on:"all",wid:null},e))}function a(e,t){var i=_.get(e,"filters_pinned_on",[]);return!!e.is_pin&&!!_.find(i,function(e){return"0"===e.filter_id.toString()||!!e.filter_id&&e.filter_id.toString()===t})}function o(e,t){return e=e||[],_.filter(e,function(e){return!a(e,t)})}function r(e,i,n){return i=parseInt(i,10),!_.isArray(e)||_.isArray(e)&&_.isEmpty(e)?[]:_.select(e,function(t){return!(_.isArray(t.visible_on)&&!_.isEmpty(t.visible_on)&&!_.contains(t.visible_on,"all")&&!_.contains(t.visible_on,n)||!_.isArray(t.filters_pinned_on))&&_.any(t.filters_pinned_on,function(e){return(0===e.filter_id||e.filter_id===i)&&(t.position=e.position,!0)})})}function s(i,n){var e=_(i).filter(function(e){return a(e,n)}).sortByOrder(["position"],["asc"]).value(),t=_.reject(i,function(e){return a(e,n)}),o=(i=_.clone(t),0);return _.each(e,function(e){for(;;){var t=e.position+o-1;if(!i[t]||!a(i[t],n)){i.splice(t,0,e);break}o++}}),_.clone(i)}function c(e,t,i,n){return e=r(e,i,n),t=o(t,i),s([].concat(e,t),i)}return{buildQuery:n,getParams:d,rejectPins:o,filterPins:r,movePins:s,mergeData:c,load:function(o,e,t){(e=e||{}).filter_id=o,e=d(e);var a=$.Deferred(),r="/widget/api?"+n(e),s="/widget/pins?"+n(e),l=e.visible_on||"all";return t=t||!1,e.filter_id?(t&&!e.tile_id?$.when($.ajax({url:s}),$.ajax({url:r})).then(function(e,t){var e=e[0],t=t[0],i=[].concat(e,t),n=c(e,t,o,l);a.resolve(n,r,s,i,t,e)},function(e){a.reject(e,r,s)}):(s=null,$.ajax(r).then(function(e){var t=[].concat(e);a.resolve(e,r,s,t,e)},function(e){a.reject(e,r,s)})),a):a.reject("The params.filter_id is required")}}}),Stackla.Plugin=Stackla.createClass(Stackla.Base,{initializer:function(e){e=e||{};var t=this;t.log("Stackla.Plugin.initializer() is executed"),t.emit("ready",[t]),t.guid=e.guid||null,t.in_iframe=self!==top},getTemplate:function(e){var t=$("#tpl-"+e);return this.log("getTemplate('"+e+"') is executed"),!(_.isUndefined(e)||!t.length)&&t.html()},getTemplates:function(){return this.log("getTemplates() is executed"),_.map($(".plugin-template"),function(e){return{key:e.id.replace("tpl-",""),html:e.innerHTML}})},getViewDimension:function(){return this.log("getViewDimension() is executed"),[document.body.scrollWidth,$("body").height()]},trackPageview:function(e){var t=!1;return this.log("trackPageView() is executed"),window._gaq&&(this.log("trackPageView() uses Google Analytics"),window._gaq.push(["_trackPageview",e]),t=!0),t}}),(()=>{var l=Stackla.createClass(Stackla.Plugin,{initializer:function(e){var t,i,n,o,a,r=this,s=(r.log("initializer() is executed (Stackla.Plugin.Tiles)"),e=e||{},r.allTiles=[],r.container=$(e.container),0===r.container.length&&(r.container=$("body")),r.appendRoot=_.isUndefined(e.appendRoot)?r.container:$(e.appendRoot),r.prependRoot=_.isUndefined(e.prependRoot)?r.container:$(e.prependRoot),r.style=e.style||{},r.config=e.config||{},r.custom_css=e.custom_css||null,r.custom_js=e.custom_js||null,r.custom_tile=e.custom_tile||null,r.filter_id=e.filter_id||0,r.search=e.search||null,r.tag_group=e.tag_group||"",r.available_products_only=e.available_products_only||!1,r.brand=e.brand||null,r.categories=e.categories||null,r.fallback_filter_id=e.fallback_filter_id||null,r.fallbacks=e.fallbacks||null,r.product_link_attribute=e.product_link_attribute||null,r.tags=e.tags||null,r.tags_grouped_as=e.tags_grouped_as||null,r.tile_id=e.tile_id||null,r.geohash=e.geohash||null,r.media=Array.isArray(e.media)?e.media.join(","):e.media||"",r.filter_options=e.filter_options||{},r.template=e.template||r.getTemplate("tile")||l.TEMPLATE,r.onInit=e.onInit||function(){},r.onLoad=e.onLoad||function(){},r.onBeforeIterate=e.onBeforeIterate||function(){},r.onIterate=e.onIterate||function(){},r.onBeforeAppend=e.onBeforeAppend||function(){},r.onAppend=e.onAppend||function(){},r.onBeforeRender=e.onBeforeRender||function(){},r.onRender=e.onRender||function(){},r.onMessage=e.onMessage||function(){},r.onBeforeInsert=e.onBeforeInsert||function(){},r.onInsert=e.onInsert||function(){},r.onBeforeLoadMore=e.onBeforeLoadMore||function(){},r.onLoadMore=e.onLoadMore||function(){},r.render?(t=r.render,r.render=function(){r.renderer(t)}):r.render=r.renderer,r.iterate?(i=r.iterate,r.iterate=function(e){return r.iterator(e,i)}):r.iterate=r.iterator,r.append?(n=r.append,r.append=function(e,t){return r.appender(e,t,n)}):r.append=r.appender,r.receive?(a=r.receive,r.receive=function(e,t){return r.receiver(e,t,a)}):r.receive=r.receiver,r.prepend?(o=r.prepend,r.prepend=function(e,t){return r.prepender(e,t,o)}):r.prepend=r.prepender,_.get(Stackla,"Display.Track"));s&&s.bind(r),r.onInit(r),r.emit("init",[r,e]),$(document).on("UPDATE_TILE",function(e,t){r.postMessage("tileUpdate",{tileChanges:t})})},emit:EventMixin.emit,on:EventMixin.on,afterFilterLoad:function(e,t,i,n){var o,a,r,s=this,l="before"+_.capitalize(e),e="onBefore"+_.capitalize(e);o=t,a=s.allTiles,r=a.map(function(e){return e._id.$id}),t=_.filter(o,function(e){return-1===r.indexOf(e._id.$id)}),s.onLoad(t,n),s.emit("load",[t,n]),s.trackPageview(i),s[e](s.appendRoot,t),s.emit(l,[s.appendRoot,t]),s.processor(t),_.each(t,function(e){s.allTiles.push(e)})},mountCss:function(){var e=$("head");this.log("renderCss() is executed"),this.custom_css&&e.append(["\x3c!-- Custom Inline CSS (start) --\x3e",'<style type="text/css">\n',this.custom_css,"</style>","\x3c!-- Custom Inline CSS (end) --\x3e"].join(""))},mountTemplate:function(){var e=this,t=$("head");e.log("renderTemplate() is executed"),e.custom_tile&&(t.append(["\x3c!-- Custom Inline Template (start) --\x3e",'<style type="text/html" id="tpl-page">\n',e.custom_tile,"</style>","\x3c!-- Custom Inline Template (end) --\x3e"].join("")),e.template=e.getTemplate("page"))},updateImageDimension:function(i,e){return this.log("updateImageDimension() is executed."),_.forEach(e,function(e,t){t=i[t];"small"===e.type?(t.image_height_s=e.height,t.image_width_s=e.width):"standard"===e.type&&(t.imageHeight=e.height,t.imageWidth=e.width)}),i},reRender:function(e){var r=this,t=Stackla.Display.Filter;return r.page=1,r.prependRoot.find(".tile").remove(),r.appendRoot.find(".tile").remove(),r.container.find(".tile").remove(),r.filter_options.page=1,r.allTiles=[],e=_.assign(r.filter_options,e),t.load(r.filter_id,e,!0).then(function(e,t,i,n){var o=r.filter_options.limit>n.length,a=$.Deferred();return e[0]&&(e[0].isFirstTile=!0),o&&e.length&&(e[e.length-1].isLastTile=!0,n[n.length-1].isLastTile=!0),r.afterFilterLoad("render",e,t,n),r.onRender(r.appendRoot,e),r.emit("render",[r.appendRoot,e]),a.resolve(e,t,i,n)})},loadMore:function(e){var r=this,t=Stackla.Display.Filter;return r.page=r.page||1,r.filter_options.page=r.filter_options.page||1,r.page+=1,r.filter_options.page+=1,r.emit("beforeLoad"),t.load(r.filter_id,r.filter_options).then(function(e,t,i,n){var o=r.filter_options.limit>n.length,a=$.Deferred();return o&&e.length&&(e[e.length-1].isLastTile=!0,n[n.length-1].isLastTile=!0),r.afterFilterLoad("loadMore",e,t,n),r.onLoadMore(r.appendRoot,e),r.emit("loadMore",[r.appendRoot,e]),a.resolve(e,t,i,n)})},appender:function(e,t,i){var n=this;n.onBeforeAppend(e,n.appendRoot),n.emit("beforeAppend",[e,t,n.appendRoot]),(e=_.isFunction(i)?i.call(n,e,t):e)&&(n.appendRoot.append(e),n.initTileEvents(e,t),n.onAppend(e,n.appendRoot),n.emit("append",[e,t,n.appendRoot]),setTimeout(function(){n.postMessage("impression",{tileData:t,filterId:n.filter_id,widgetId:n.widgetConfig.id})},500))},iterator:function(e,t){var i=this;return i.emit("beforeIterate",[e,e.id]),i.onBeforeIterate(e,e.id),i.log("iterator() is executed. The tile ID is '"+e.id+"'"),_.isFunction(t)&&t.call(i,e),t=Mustache.render(i.template,e),i.emit("iterate",[e,t]),i.onIterate(e,t),t},initTileEvents(e,t){e.on("mouseenter",()=>{this.postMessage("tileHover",{tileData:t,filterId:this.filter_id,widgetId:this.widgetConfig.id})})},processor:function(e){var i=this,t=_.get(Stackla,"Display.Crowdsource");if(!_.isArray(e))return!1;i.log("processor() is executed"),t.load(e,i.widgetConfig.stack_id),_.forEach(e,function(e){e.id="tile-"+e._id.$id,StacklaTileDecorator.decorate(e),e.class_names=_.uniq(i._getClassNames(e)).join(" "),Stackla.Widget.ClickThrough&&(e=Stackla.Widget.ClickThrough.decorateTile(e,i.widgetConfig)),Stackla.Widget.User&&(e=Stackla.Widget.User.decorateTile(e,i.widgetConfig));var t=i.iterate(e);i.append($(t),e)})},renderer:function(a){var r=this,e=Stackla.Display.Filter;return r.log("renderer() is executed"),r.emit("beforeLoad"),e.load(r.filter_id,r.filter_options,!0).then(function(e,t,i,n){var o=r.filter_options.limit>n.length;e[0]&&(e[0].isFirstTile=!0),o&&e.length&&(e[e.length-1].isLastTile=!0,n[n.length-1].isLastTile=!0),r.afterFilterLoad("render",e,t,n),a.call(r,r.appendRoot),r.onRender(r.appendRoot,e),r.emit("render",[r.appendRoot,e])})},receiver:function(t,i,n){var o,a=this,r=$.Deferred(),e=_.get(Stackla,"Display.Crowdsource");return n=n||function(){},o=function(e){_.forEach(e,function(e){e.id="tile-"+e._id.$id,StacklaTileDecorator.decorate(e);var t=a.iterate(e);a.prepend($(t),e)}),a.onInsert(a.prependRoot,e),a.emit("insert",[a.prependRoot,e]),n.call(a,e,i),r.resolve(e,i)},e.load(t,a.widgetConfig.stack_id).then(function(e){e=_.filter(e,{state:"success"}),t=a.updateImageDimension(t,e),o(t)}),r.promise()},prepender:function(e,t,i){var n=this;n.onBeforeAppend(e,n.prependRoot),n.emit("beforeAppend",[e,t,n.prependRoot]),(e=_.isFunction(i)?i.call(n,e,t):e)&&(n.prependRoot.prepend(e),n.initTileEvents(e,t),n.onAppend(e,n.prependRoot),n.emit("append",[e,t,n.prependRoot]),setTimeout(function(){n.postMessage("impression",{tileData:t,filterId:n.filter_id,widgetId:n.widgetConfig.id})},500))},_handleDataMessage:function(e,t,i){var n=this;n.log("handleNewMessage() is executed"),n.trackPageview(n.dataProvider.list_url),n.onMessage(t,i),n.emit("message",[t,i]),n.onBeforeInsert(n.prependRoot,t),n.emit("beforeInsert",[n.prependRoot,t]),n.receive(t,i)},_getClassNames:function(e){var t=["tile","tile--"+e.media];return e.is_pin&&t.push("tile--pinned"),t}});l.POLLING_INTERVAL=1e4,l.VISIBLE_ON="widget",l.TEMPLATE='<div id="{{_id.$id}}" class="tile">{{message}}</div>',Stackla.Plugin.Tiles=l})(),((e,t)=>{"object"==typeof module&&module.exports?module.exports=t():_.set(e,"Stackla.Widget.Comments",t())})(this,function(){return{add:function(e,t,i){i=i||{};var n=new $.Deferred,o=i.widget_id,a={},r={stack_id:i.stack_id,tile_id:i.tile_id,username:e,comment:t};return i.data_user_id&&(a.data_user_id=i.data_user_id),i.data_user_hash&&(a.data_user_hash=i.data_user_hash),i.data_user_name&&(a.data_user_name=i.data_user_name),e="/widget/save_comment/"+o,e=_.isEmpty(a)?e:e+"?"+$.param(a),$.ajax({url:e,type:"POST",data:r}).then(function(e){e.success?n.resolve(e,r,a):n.reject(e,r,a)},function(e){n.reject(e,r,a)}),n},load:function(e){e=e||{};var t=new $.Deferred,i={stack_id:e.stack_id,tile_id:e.tile_id,last_comment_id:e.last_comment_id,how_many:e.how_many||5};return i.stack_id&&i.tile_id?($.ajax({url:"/widget/comments",type:"GET",data:i}).then(function(e){t.resolve(e,i)},function(e){t.reject(e)}),t):t.reject("The stack_id and tile_id props are requierd")}}}),((e,t)=>{"object"==typeof module&&module.exports?module.exports=t():_.set(e,"Stackla.Widget.Interaction",t())})(this,function(){function d(e,t,i,n){var t=t._id?t._id.$id:null,o=r(e),a=$.cookie(o);o&&(t="vote"===e?s(t,n):t,a=_.isString(a)?a.split(","):[],a=i?_.union(a,[t]):_.without(a,t),e=new Date((new Date).getTime()+36e5),$.cookie(o,a.join(","),{expires:e,path:"/; SameSite=None",secure:!0}))}function u(t,i,e,n){var o=t.id,a="like"===i?"numUps":"numDowns",r=t[a]+e,s=!1,l=$(".tile[data-id="+o+"] .tile-interaction-"+i);return t?(s=g(i,t,n),0<e?s=!0:e<0&&(s=!1),function(e){s=e?g(i,t,n):s,s=!!r&&s,t[a]=r,l.length&&(l.toggleClass("on",s),l.find(".tile-interaction-count").text(r||"")),d(i,t,s,n)}):$.noop}function r(e){var t=null;switch(e){case"up":case"like":t="votedUp";break;case"down":case"dislike":t="votedDown";break;case"vote":t="votedCompetitionStac9392"}return t}function s(e,t){return _.get(t,"style.parent_page_permission")?(e=[getUrlVars().data_user_id,t.stack_id,e].join(","),CryptoJS.MD5(e).toString().substr(0,6)):e}function l(t,i,n,o){var a,r=$.Deferred(),s="like"===i?"dislike":"like",l=u(t,i,0,n),d=u(t,s,0,n),e=g(i,t,n),c=!e;return u(t,i,e?-1:1,n)(),a=g(s,t,n)?(u(t,s,-1,n)(),function(e){l(e),d(e)}):function(e){l(e)},h(t.id,i,c,n).then(function(e){e.success?r.resolve(e):r.reject(e.error,a)},function(e,t,i){r.reject(i,a)}).always(function(){var e;_.isFunction(o)&&((e={})[i]={on:g(i,t,n),count:t[p(i)]},e[s]={on:g(s,t,n),count:t[p(s)]},o(e))}),r}function p(e){return"like"===e?"numUps":"numDowns"}function s(e,t){return _.get(t,"style.parent_page_permission")?(e=[getUrlVars().data_user_id,t.stack_id,e].join(","),CryptoJS.MD5(e).toString().substr(0,6)):e}function g(e,t,i){var n=r(e),t=t._id?t._id.$id:null,o=$.cookie(n);return!!n&&(t="vote"===e?s(t,i):t,o=_.isString(o)?o.split(","):[],_.contains(o,t))}function f(e,t,i){var n,o=e.id,a=e.numVotes+t,r=$(".tile[data-id="+o+"] .tile-interaction-vote");return e?(n=g("vote",e,i),function(){e.vote=a,n=1===t||n,r.length&&(r.toggleClass("on",n),r.find(".tile-interaction-count").text(a||"")),d("vote",e,n,i)}):$.noop}function h(e,t,i,n){e=$.param({wid:n.guid,tile:e,up:"like"===t?"up":"down",add:i?1:0});return $.ajax({url:"/widget/like_dislike/"+n.id,data:e,type:"POST"})}function c(e,t,i){var n,o=e.id,a=t.id,r=$.Deferred(),s=t.style.parent_page_permissions,l=g("vote",e,t),d=e.numVotes?parseInt(e.numVotes):0,c=getUrlVars();return l?r.reject(window.Strings&&window.Strings.voting_message||"A vote has already been registered from this IP address."):(l="/widget/competition_vote/"+a,a=["wid="+t.guid,"tile_id="+o,"addordelete=1"],!s||c.data_user_id&&c.data_user_hash?(s&&(a.push("data_user_id="+c.data_user_id),a.push("data_user_hash="+c.data_user_hash),a.push("data_user_name="+(c.data_user_name||""))),n=f(e,0,t),f(e,1,t)(),$.ajax({url:l,type:"POST",data:a.join("&")}).then(function(e){e.success?r.resolve(e):(e=/^A vote has already been registered from this IP address/.test(e.error)&&window.Strings&&window.Strings.voting_message||e.error,r.reject(e,n))},function(e,t,i){r.reject(i,n)}).always(function(){_.isFunction(i)&&i({vote:{on:!0,count:d+1}})}),r):r.reject("Oops, an error occurred with the vote interaction: Invalid user ID and hash combination."))}return{addCookie:d,bindLikeDislike:function(e,t,o,a){var r=!1,i=function(e){var t=$(e.currentTarget),i=t.data("id"),t=t.data("action"),n=o(),n=_.find(n,{id:i});e.stopPropagation(),"like"!==t&&"dislike"!==t||r||(r=!0,l(n,t,a).then(function(){$(document).trigger("tileLike",[{_id:i}])},function(e,t){window.alert(e),t&&t("You have voted."===e)}).always(function(){r=!1}))};$(e).on("click",t,i)},bindVote:function(e,t,o,a){var r=!1,i=function(e){var t=$(e.currentTarget),i=t.data("id"),t=t.data("action"),n=o(),n=_.find(n,{id:i});e.stopPropagation(),"vote"!==t||r||(r=!0,c(n,a).then(function(){$(document).trigger("tileVote",[{_id:i}])},function(e,t){window.alert(e),t&&t("You have voted."===e)}).always(function(){r=!1}))};$(e).on("click",t,i)},checkVote:function(t,e){return!(!t||!e)&&_.some(e,function(e){return 0<_.intersection(t.tags,e.voting_tags).length})},fnUpdateLikeDislike:u,getCookieKey:r,getVoteId:s,hasCookie:g,likeDislike:l,sync:h,vote:c}}),(()=>{var e=Stackla.createClass(Stackla.Plugin.Tiles,{initializer:function(e){var t=this,i=_.get(window,"Stackla.Widget.Interaction",{});if(t.log("initializer() is executed"),e=e||{},$(document).trigger("widget:ready",[this]),t.widgetConfig=_.cloneDeep(e),t.isVideoRefreshEnabled=0!==parseInt(_.get(t.widgetConfig,"stack_config.enable_ig_video_refresh",1)),t.domain=e.domain||null,t.stack_id=e.stack_id||null,t.unique_id=t.getParams("unique_id"),t.style=e.style,t.widget_id=e.widget_id,t.draft_id=e.draft_id||null,t.filter_options=null,t.tiles_per_page="base_quadrant"===_.get(e,"style.style")?5*(_.get(e,"style.blocks_per_page")||6):e.tiles_per_page||_.get(e,"style.tiles_per_page",30),t.single_tile_data=null,!t.guid||!t.filter_id||!t.domain)throw new Error("It lacks of guid, filter_id, or domain options");t.filter_options=_.assign({geohash:t.geohash,filter_id:t.filter_id,is_polling:_.get(t.widgetConfig,"style.auto_refresh",!1),polling:1e3*_.get(t.widgetConfig,"style.polling_frequency",30),limit:t.tiles_per_page,list_url:"/widget/api",pin_url:"/widget/pins",page:1,search:t.search,tag_group:t.tag_group,available_products_only:t.available_products_only,brand:t.brand,categories:t.categories,fallbacks:t.fallbacks,fallback_filter_id:t.fallback_filter_id,product_link_attribute:t.product_link_attribute,data_tags:t.tags,tags_grouped_as:t.tags_grouped_as,tile_id:t.tile_id,ttl:30,visible_on:"widget"},e.filter_options||{}),t.media&&(t.filter_options.media=t.media),t.draft_id?(t.filter_options.draft_id=t.draft_id,t.filter_options.ttl=1):t.guid?t.filter_options.wid=t.guid:(t.filter_options.list_url+="/"+e.guid,t.filter_options.pin_url+="/"+e.guid),$(".track").on("click",".tile",t.handleTileClick.bind(t)),$(".track").on("click",".tile-interaction-comment",t.handleCommentClick.bind(t)),i.bindLikeDislike($(".track"),".tile-interaction-like, .tile-interaction-dislike",function(){return t.allTiles},t.widgetConfig),i.bindVote($(".track"),".tile-interaction-vote",function(){return t.allTiles},t.widgetConfig),t.postMessage("handShakeEstablished"),window.addEventListener?window.addEventListener("message",t._handleMessage.bind(this),!1):window.attachEvent("onmessage",t._handleMessage.bind(this))},toString:function(){return"Widget"},getComments:function(t,e,i){var n=this;_.get(window,"Stackla.Widget.Comments",{}).load({tile_id:t,last_comment_id:e,stack_id:n.stack_id,how_many:i}).then(function(e){n.postMessage("getCommentsCallback",{tileId:t,data:e})})},postComment:function(e,t,i,n){var o=this,a=o.widgetConfig.style.parent_page_permissions,r=_.get(window,"Stackla.Widget.Comments"),s=_.get(window,"Stackla.Display.Util",{}).getUrlParams(),l={};!a||s.data_user_id&&s.data_user_hash?(l={stack_id:o.stack_id,tile_id:t,widget_id:e},a&&(l.data_user_id=s.data_user_id,l.data_user_hash=s.data_user_hash,l.data_user_name=s.data_user_name),r.add(i,n,l).then(function(e){return $(document).trigger("tileComment",[{_id:t}]),e}).always(function(e){o.postMessage("postCommentCallback",{data:e,tileId:t})})):window.console&&console.error("Oops, an error occurred with the vote interaction: Invalid user ID and hash combination.")},postEvent:function(e,t,i,n){var o=$.Deferred(),a=this;return t=t||{},n=n||function(){},(i=i||!1)?(a.emit(e,[t],function(){delete t.widgetId,a.postMessage(e,t),n(e,t),o.resolve(e,t)}),o):(a.emit(e,[t]),delete t.widgetId,a.postMessage(e,t),n(e,t),o.resolve(e,t))},postMessage:function(e,t){var i=this,n=i.widgetConfig??{};i.log("postMessage("+e+") is executed"),t=$.extend({action:e,appearance:n.style,filterId:n.filter_id,focusOn:null,hashId:n.guid,layoutType:_.get(n,"config.lightbox.layout","portrait"),options:n.lightboxConfig,parentPagePermissions:n.parent_page_permissions?{on:!0,userId:i.getParams("data_user_id")||null,userHash:i.getParams("data_user_hash")||null,userName:i.getParams("data_user_name")||null,parent_page_ext_username:n.parent_page_ext_username}:null,shopspotsEnabled:_.get(n,"permission.shopspots",!1),style:n.style,styleName:_.get(n,"style.style"),uniqueId:i.getParams("unique_id"),widgetConfig:n,widgetId:n.widget_id},t),parent.postMessage(JSON.stringify(t),"*")},initCompleteCallback:function(e,t){e?this.showExpandedTile(e):trackPerformance({embed_timestamp:t.embed_timestamp,init_timestamp:t.init_timestamp,parent_host:t.parent_host,parent_url:t.parent_url})},_handleMessage:function(e){var i=this,t=e.data;try{t=JSON.parse(t)}catch(e){}if(t&&t.action)switch(t.action){case"stackla:widget:getNextTileIdByCurrentTileId":var n=_.reject(i.allTiles,function(e){return"rss"===e.source||"stackla"===e.source&&e.click_through}),o=t.args[0],a=_.findIndex(n,function(e){return e._id.$id===o});(s=n[r=a+1])?i.showExpandedTile(s._id.$id):i.loadMore().then(function(e,t){(s=n[r])&&i.showExpandedTile(s._id.$id)});break;case"stackla:widget:getPreviousTileIdByCurrentTileId":var r,s,n=_.reject(i.allTiles,{source:"rss"}),o=t.args[0],a=_.findIndex(n,function(e){return e._id.$id===o});(s=n[r=a-1])&&i.showExpandedTile(s._id.$id);break;case"changeFilter":isNaN(parseInt(t.filterId))||i.changeFilterCallback&&i.changeFilterCallback(t.filterId,t.tags,t.group);break;case"searchFilter":i.searchFilterCallback&&i.searchFilterCallback(t.search);break;case"initComplete":void 0!==t.lightbox_id&&t.lightbox_id&&(a=/^ct_(.*)/.exec(t.lightbox_id))&&a.length&&a[1]&&i.initCompleteCallback(a[1]),i.parentUrl=t.parent_url;break;case"getComments":i.getComments&&i.getComments(t.tileId,t.lastCommentId,t.howMany);break;case"postComment":i.postComment&&i.postComment(t.widgetId,t.tileId,t.username,t.comment);break;case"getShortUrl":i.getShortUrl&&i.getShortUrl(t.thatId,t.url,t.tileId);break;case"saveShareCount":i.saveShareCount&&i.saveShareCount(t.tileId);break;case"loadMore":i.loadMoreTiles&&i.loadMoreTiles();break;case"scrollToPageBottom":i.scrollToPageBottom&&i.scrollToPageBottom();break;case"sendParentDimensions":i.resizeWrapper&&i.resizeWrapper(t);break;case"interactionSend":var l=t.tile_id,d=t.type,c=function(e){i.crossSiteAction&&i.crossSiteAction("interactionSendCallback",{tile_id:l,type:d,data:e})};switch(d){case"like":case"dislike":i.likeDislike&&i.likeDislike(l,d,c);break;case"vote":i.competitionVote&&i.competitionVote(l,c)}break;case"setUniqueId":i.setUniqueId&&(i.setUniqueId(t.uniqueId),i.crossSiteAction("handShakeEstablished"));break;case"setCustomData":i.setCustomData&&i.setCustomData(t.customData);break;case"reportAssetBroken":a=_.get(Stackla,"Display.Crowdsource");a&&a.reportBroken(t.tileId,i.widgetConfig.stack_id)}},handleCommentClick:function(e){var t=this,i=$(e.currentTarget).data("id"),n=t.widgetConfig,o=_.find(t.allTiles,{id:i});t.log("handleCommentClick() is executed"),e.stopPropagation(),t.postEvent("tileExpand",{expandType:"expand",tileData:o,widgetId:n.widget_id},!0).then(function(){t.showExpandedTile(o._id.$id,"comment")})},handleTileClick:function(e){var t=this,i=$(e.target),e=$(e.currentTarget),n=t.widgetConfig,e=e.data("id"),o=_.find(t.allTiles,{id:e}),e=_.get(n,"style.click_through_url"),a=o.click_through_link;if(t.log("handleTileClick() is executed"),o.enable_click_through&&o.click_through)t.postEvent("tileExpand",{expandType:"custom",tileData:o,widgetId:n.widget_id}).then(function(){window.open(o.click_through)});else if(!i.closest(".tile-twitter-intent-link").length&&o&&"[NONE]"!==e){if(!a)return"[ORIGINAL_URL]"===e?"stackla"===o.source||"sta_feed"===o.source?void 0:void t.postEvent("tileExpand",{expandType:"original",tileData:o,widgetId:n.widget_id}).then(function(){window.open(o.original_url)}):void("[EXPAND]"===e&&("rss"===o.source?t.postEvent("tileExpand",{expandType:"original",tileData:o,widgetId:n.widget_id}).then(function(){window.open(o.original_url)}):t.postEvent("tileExpand",{expandType:"expand",tileData:o,widgetId:n.widget_id},!0).then(function(){t.showExpandedTile(o._id.$id)})));t.postEvent("tileExpand",{expandType:"custom",tileData:o,widgetId:n.widget_id}).then(function(){window.open(a)})}},getShortUrl:function(e,t,i){var n=_.get(this,"config.lightbox.disable_short_url",!1),o=this;"false"!==_.get(this,"config.lightbox.show_sharing")&&_.get(this,"config.lightbox.show_sharing")&&(n?o.postMessage("getShortUrlCallback",{shortUrl:t}):o.generateShareUrl(i).then(function(e){o.postMessage("getShortUrlCallback",{shortUrl:e})}))},generateShareUrl:function(t){var e=_.get(Stackla,"Widget.Share"),i=_.find(this.allTiles,function(e){return e._id.$id===t})||this.single_tile_data,n=e.getRedirectUrl(this.parentUrl,t),n=e.getParams(n,i,this.widgetConfig);return i.share_url?$.Deferred().resolve(i.shareUrl||i.share_url):e.generateShortUrl(n).then(function(e){return i.share_url=e})},ready:function(e){var t=this.widgetConfig,i=_.get(t,"style.minimal_tiles",1);this.renderTime=new Date,e=_.assign({widgetType:"vertical",externalJs:t.external_js,lightboxCustomCss:t.lightbox_custom_css,lightboxCustomJs:t.lightbox_custom_js,hideWidget:this.allTiles.length<i,name:t.name,options:t.config.lightbox},e),this.postMessage("initComplete",e)},showExpandedTile:function(t,i){function n(e){_.has(e,"id")||(e.id=_.get(e,"_id.$id")),e.isFirstTile=r,e.prevLightboxId=s?_.get(s,"_id.$id"):null,e.nextLightboxId=l?_.get(l,"_id.$id"):null,e.interactionData={like:{on:c.hasCookie("up",e,d),count:e.numUps||""},dislike:{on:c.hasCookie("down",e,d),count:e.numDowns||""},vote:{on:c.hasCookie("vote",e,d),count:e.numVotes||""}},o.postMessage("lightbox",{data:e,focusOn:i,options:d.config.lightbox,widgetId:d.widget_id,tileId:e._id.$id,widgetType:"vertical",videoHtml:StacklaVideoPlayer.getEmbedCode("#tpl-video",$.extend({},e)),widgetSetting:d,widgetConfig:d,lightboxCustomCss:d.lightbox_custom_css,lightboxCustomJs:d.lightbox_custom_js})}var o=this,e=_.findIndex(o.allTiles,function(e){return e._id.$id===t}),a=o.allTiles[e],r=0===e,s=r?null:o.allTiles[e-1],l=e+1!==o.allTiles.length?o.allTiles[e+1]:null,d=o.widgetConfig,c=_.get(window,"Stackla.Widget.Interaction",{});o.log("showExpandedTile('"+t+"') is executed");a?n(a):$.ajax({url:"/widget/single",data:{stack_id:o.stack_id,tile_id:t,ttl:o.filter_options.ttl},dataType:"json",success:function(e){o.single_tile_data=e,n(e)}})}});Stackla.Plugin.Widget=e})(),(()=>{var l=window.Stackla=window.Stackla||{};_.assign(l,{expandTile:function(e,t,i){e=e||{},i=i||{},_.isPlainObject(t)&&(t=_.assign({layout:"portrait",show_additional_info:"1"},t)),_.isString(t)&&_.includes(["portrait","landscape"],t)&&(t={layout:t,show_additional_info:"1"}),this.postMessage("lightbox",_.assign({data:e,options:t,tileId:e.id},i))},postMessage:function(e,t){var i=l.widgetOptions||{};(t=t||{}).action=e,t.uniqueId=l.Display.Util.getUrlParams("unique_id"),t.widgetType=i.style.type,t.widgetId=i.id,t.hashId=i.guid,t.parentPagePermissions=null,t.styleName=i.style?i.style.style:null,t.style=i.style||null,t.widgetConfig=i,parent.postMessage(JSON.stringify(t),"*")},loadJS:function(e,t){var i=$.Deferred();return e=_.clone(e),t=t||function(){},StacklaLazyLoad.js(e,function(){t(),i.resolve()}),i},loadTilesByFilter:function(){var e=arguments,t=_.isPlainObject(e[0])?e[0]:{},i=_.isFunction(e[e.length-1])?e[e.length-1]:function(){},e=l.widgetOptions||{},n=$.Deferred(),o=t.filter_id||e.filter_id,a=l.Display.Filter,o=o.toString();return(t=_.assign({},function i(e){return _.isObject(e)?_(e).omit(_.isUndefined).omit(_.isNull).map(function(e,t){return[t,i(e)]}).object().value():e}({filter_id:o,limit:e.limit||30,page:t.page||1,search:e.search||null,tags:e.tags||null,data_tags:e.data_tags||null,tags_grouped_as:e.tags_grouped_as||null,tile_id:t.tile_id||e.tile_id||null,ttl:e.ttl||30,visible_on:"widget"}),t)).filter_id=t.filter_id.toString(),e.draft_id?(t.ttl=1,t.draft_id=e.draft_id):e.guid&&(t.wid=e.guid),e=1===t.page&&!t.tile_id,a.load(o,t,e).then(function(e){e=_.map(e,function(e){return e.id="tile-"+e._id.$id,StacklaTileDecorator.decorate(e)}),i(e),n.resolve(e)}),n},render:function(e){var t,i=this,n=arguments,o=_.isPlainObject(n[1])?n[1]:{},n=_.isFunction(n[n.length-1])?n[n.length-1]:function(){},a=$.Deferred(),r=i.render.isRendered,s={},o=_.assign({$container:$(document.body),auto_resize:!0,template:$("#tpl-layout").html(),setting:l.widgetOptions},o);return $('script[type="text/html"][id^=tpl-]').each(function(e,t){"tpl-layout"!==t.id&&(s[t.id]=t.innerHTML)}),_.isFunction(o.renderer)?t=o.renderer(e,o,s):(t=Mustache.render(o.template,e,s),$(o.$container).prepend(t)),r||i.postMessage("initComplete",{layoutType:"portrait",name:o.setting.name}),o.auto_resize&&i.postMessage("resize",{height:$("body").height()}),r||(o.auto_resize&&$(window).resize(_.debounce(function(){i.postMessage("resize",{height:$("body").height()})},300)),i.render.isRendered=!0),n(t,e,o),a.resolve(t,e,o)}})})();